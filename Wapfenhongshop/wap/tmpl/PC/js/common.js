/*带有sweetalert插件提示的登录验证  */ function check_login() {    if (!FL.token) {        swal({                title: "",                text: "请先登录",                type: "warning",                confirmButtonColor: "#DD6B55",                confirmButtonText: "确定",                closeOnConfirm: false            },            function() {                location.href = WapSiteUrl + "/wap/tmpl/login/login.html";            });    }}/* 微店安卓客户端调用，写入cookie*/function onSignWap(key, userid, username) {    //alert(userid);    addcookie('key', key);    addcookie('userid', userid);    addcookie('username', username);    addcookie('istuiguang', 1);    //$("body").append('<div style="padding-bottom:4em;">key='+key+'</div>');}	//全局监听ajax	var _ajax = $.ajax;	$.ajax = function(options){		options.timeout = options.timeout||30000;				var _success = options.success || function(){};		var _error = options.error || function(){};		var _complete = options.complete || function(){};				options.success = function(xhr,status,err){			if(xhr&&xhr.error=="0010"){				layer.msg("您的账号已在别的地方登录");				delCookie("mid");				delCookie("token");				setTimeout(function(){					location.href="../login/login.html";				},1000);			}else if(xhr&&xhr.error=="0009"){				delCookie("mid");				delCookie("token");			}			_success(xhr,status,err);		};		options.error = function(xhr,status,err){			if(status == "timeout"){				$(".layui-layer-shade").remove();        		$(".layui-layer-loading").remove();        		layer.msg("请求超时");     	   	}else if(xhr){     	   		     	   	}					};		options.complete = function(xhr,status,err){					}		//调用原始ajax获取数据		xhr = _ajax(options);		return xhr;	}//ajax loading$(document).on("ajaxStart",function() {	try{		layer.load(1, {            shade: [0.5, '#000000'] //0.1透明度的白色背景        });	}catch(e){ 		 	}       });$(document).on("ajaxComplete",function() {    setTimeout(function() {        $(".layui-layer-shade").remove();        $(".layui-layer-loading").remove();                    }, 100);});function GetQueryString(name) {    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");    var r = window.location.search.substr(1).match(reg);    if (r != null)        return decodeURI(r[2]);    return null;}function addcookie(name, value, days) {    days = days || 0;    var expires = "";    if (days != 0) {        var date = new Date();        date.setTime(date.getTime() + (days * 24 * 3600 * 1000));        expires = "; expires=" + date.toGMTString();    }    document.cookie = name + "=" + escape(value) + expires + "; path=/";}function getcookie(name) {    var strcookie = document.cookie;    var arrcookie = strcookie.split("; ");    for (var i = 0; i < arrcookie.length; i++) {        var arr = arrcookie[i].split("=");        if (arr[0] == name)            return arr[1];    }    return "";}function delCookie(name) { //删除cookie    var exp = new Date();    exp.setTime(exp.getTime() - 1);    var cval = getcookie(name);    if (cval != null)        document.cookie = name + "=" + cval + "; path=/;expires=" + exp.toGMTString();}function checklogin(state) {    if (state == 0) {        location.href = WapSiteUrl + '/tmpl/member/login.html';        return false;    } else {        return true;    }}/*时间戳转日期*/function getLocalTime(nS) {             return new Date(parseInt(nS) * 1000);};function contains(arr, str) {    var i = arr.length;    while (i--) {        if (arr[i] === str) {            return true;        }    }    return false;}function buildUrl(type, data) {    switch (type) {        case 'keyword':            return WapSiteUrl + '/tmpl/product_list.html?keyword=' + encodeURIComponent(data);        case 'special':            return WapSiteUrl + '/special.html?special_id=' + data;        case 'goods':            return WapSiteUrl + '/tmpl/product_detail.html?goods_id=' + data;        case 'url':            return data;    }    return WapSiteUrl;}/* 卖家版APP调用函数 */function appDisplayElement(_type, _name, _value) {    var num = 0;    if (_type == 'id') {        //document.getElementById(_name).style.display = value;        $("#" + _name).css("display", _value);        var setIntApp = window.setInterval(function() {            num++;            $("#" + _name).css("display", _value);            if (num > 100) {                window.clearInterval(setIntApp);            }        }, 100);    } else {        //document.getElementsByClassName(_name).style.display = _value;        $("." + _name).css("display", _value);        var setIntApp = window.setInterval(function() {            num++;            $("." + _name).css("display", _value);            if (num > 100) {                window.clearInterval(setIntApp);            }        }, 100);    }}//页面加载 如果存在导航栏就添加点击事件if($("#nav-show")){	var dom = '<ul class="nav-bar animated fadeInDown" id="nav-bar">'            	+'<li><a class="nav-header-tab" link="../index/index.html"><img src="../../images/wap/shouye.png">首页</a></li>'            	+'<li><a class="nav-header-tab" link="../activity/discover.html"><img src="../../images/wap/faxian.png">发现</a></li> '            	+'<li><a class="nav-header-tab" link="../index/index_global.html"><img src="../../images/wap/global.png">全球购</a></li> '            	+'<li><a class="nav-header-tab" link="../shopping/shopping_cart_cn.html"><img src="../../images/wap/gouwuche.png">购物车</a></li>'            	+'<li><a class="nav-header-tab" link="../member/person.html"><img src="../../images/wap/wode.png">我的</a></li>'            +'</ul>'	$("#nav-show").click(function(){		if($("#nav-bar").length==0){			$("header").after(dom);			bindClick();		}else{			$("#nav-bar").attr("class","nav-bar animated fadeOutUp");			setTimeout(function(){				$("#nav-bar").remove();			},400);		}	});		function bindClick(){		$(".nav-header-tab").click(function(){			var me = this;			var href = $(me).attr("link");			location.href = href;			$("#nav-bar").remove();		})	}}//通用兼容zepto滚动function scroll(scrollTo, time) {    var scrollFrom = parseInt(document.body.scrollTop),        i = 0,        runEvery = 5; // run every 5ms    scrollTo = parseInt(scrollTo);    time /= runEvery;    var interval = setInterval(function () {        i++;        document.body.scrollTop = (scrollTo - scrollFrom) / time * i + scrollFrom;        if (i >= time) {            clearInterval(interval);        }    }, runEvery);}/* * JAVASCRIPT 常用JS方法库 *  */(function() {    //注册命名空间gyb到window对象上      window['FL'] = {};	FL.mid = getcookie("mid")||"";	FL.token = getcookie("token")||"";	FL.store_id = getcookie("store_id")||"";    //判断是否微信浏览器     function isWeiXin() {        var ua = window.navigator.userAgent.toLowerCase();        if (ua.match(/MicroMessenger/i) == 'micromessenger') {            return true;        } else {            return false;        }    }    ;    //获取滚动条当前的位置     function getScrollTop() {        var scrollTop = 0;        if (document.documentElement && document.documentElement.scrollTop) {            scrollTop = document.documentElement.scrollTop;        } else if (document.body) {            scrollTop = document.body.scrollTop;        }        return scrollTop;    }    ;    //获取当前可视范围的高度     function getClientHeight() {        var clientHeight = 0;        if (document.body.clientHeight && document.documentElement.clientHeight) {            clientHeight = Math.min(document.body.clientHeight, document.documentElement.clientHeight);        } else {            clientHeight = Math.max(document.body.clientHeight, document.documentElement.clientHeight);        }        return clientHeight;    }    ;    //获取文档完整的高度    function getScrollHeight() {        return Math.max(document.body.scrollHeight, document.documentElement.scrollHeight);    }    ;    //滚动到底部加载数据    function scrollEndLoad(callback) {        $(window).on('scroll', function() {            if (getScrollTop() + getClientHeight() == getScrollHeight()) {                callback();            }        });    }    ;    //回到顶部    function toTop(n) {        $(window).on('scroll', function() {            //alert(getScrollTop()+"!"+getScrollHeight());            if ($("#totop").size() > 0) {                if (getScrollTop() < $(window).height() * n) {                    $("#totop").remove();                }            } else {                if (getScrollTop() >= $(window).height() * n) {                    $("body").after("<div id='totop'></div>");                    $("#totop").on('click', function() {                       scroll(0,200);                    });                }            }        });    }    ;    //字符串截取，超出则加“...”    function subStrLen(str, len) {        if (str.length > len) {            str = str.substring(0, len) + "...";        }        return str;    }    ;    /*判断对象(json)是否为空*/    function isEmptyObject(obj) {        var name;        for (name in obj) {            return false;        }        return true;    }    ;    /*     * 占位符格式化     * 第一个参数为需要格式化的字符串："aa{0}bb{1}" *必填     * 后面的参数为对应替换的字符串     * DEMO:  formatStr("aa{0}bb{1}","F","L");//得到的结果为：aaFbbL     * @returns      */    function formatStr() {        var ary = [];        for (i = 1; i < arguments.length; i++) {            ary.push(arguments[i]);        }        return arguments[0].replace(/\{(\d+)\}/g, function(m, i) {            return ary[i];        });    }    ;    //提示信息    function validMsg() {        return {            need: "{0}不能为空！",            telephone: "{0}格式不正确！",            min: "请输入{0}个字符以上",            max: "请输入{0}个字符以内",            sameto: "两次输入不同"        };    }    ;    /*     * 传入表单项，根据属性进行验证     * @param {zepto对象} $item      * need:必填      * @returns {undefined}     */    function validItem($item) {        var msg = validMsg();        var currMsg = "";        var itemval = $.trim($item.val());        //判断是否必填        if ($item[0].hasAttribute("need")) { //是必填            if (itemval == "") {                currMsg = formatStr(msg["need"], $item.attr("tip"));                return currMsg;            }        }        //最小长度        if ($item[0].hasAttribute("min")) {            if (itemval.length < parseInt($item.attr("min")) && itemval != "") {                currMsg = formatStr(msg["min"], $item.attr("min"));                return currMsg;            }        }        //最大长度        if ($item[0].hasAttribute("max")) {            if (itemval.length > parseInt($item.attr("max")) && itemval != "") {                currMsg = formatStr(msg["max"], $item.attr("max"));                return currMsg;            }        }        //比较两次输入        if ($item[0].hasAttribute("sameto")) {            if (itemval != $("#" + $item.attr("sameto")).val()) {                currMsg = $item.attr("tip");                return currMsg;            }        }        //判断是否是手机号        if ($item[0].hasAttribute("telephone")) {            if (!(/^1[1-9][0-9]\d{8}$/.test(itemval)) && itemval != "") {                currMsg = formatStr(msg["telephone"], $item.attr("tip"));                return currMsg;            }        }        return currMsg;    }    //表单项验证    //vlist:所有需要验证的表单元素（id集合，例：{"aa","bb"}）    function valid(vlist, extFun) {        var errorMsg = {};        for (var item in vlist) {            var temp = validItem($("#" + vlist[item]));            if (temp != "") {                errorMsg[vlist[item]] = temp;            }        }        extFun(errorMsg);    }    //获取验证码倒计时60s    function countDown(time, self) {            self.attr("disabled", true);            if (time == 0) {                self.removeAttr("disabled");                self.text("获取验证码");                //clearTimeout(num);                return false;            } else {                self.text("重新发送(" + time + ")");                time--;            }            setTimeout(function() {                countDown(time, self);            }, 1000);        }        /**         * 地区联动         * */    function getProvinceBuy(dom) {        var proStr = selectArea();        $("body .dqld_div").remove();        var height = $(window).height();        var newStr = new Array();        newStr.push("<div class=\"dqld_div animated slideInRight\"><ul class='dqld_ul'>");        for (var i = 0; i < proStr.length; i++) {            var id = proStr[i].area_id;            var provinceName = proStr[i].area_name;            newStr.push("<li onclick=\"FL.getCityBuy(" + id + ",'" + dom + "','" + provinceName + "')\">" + provinceName + "</li>");        }        newStr.push("</ul></div>");        $("body").append(newStr.join(""));        $(".dqld_div").css("height", height + "px");        $("body").css("overflow", "hidden");        addShade();        closeDiv(".dqld_div", "remove");    }    function getCityBuy(val, dom, name) {        var proStr = selectArea(val);        var newStr = new Array();        newStr.push("<div class=\"dqld_div \"><ul>");        newStr.push("<li onclick=\"getProvinceBuy()\" class='bck-one'>" + name + "</li>");        for (var j = 0; j < proStr.length; j++) {            var id = proStr[j].area_id;            var cityName = proStr[j].area_name;            newStr.push("<li onclick=\"FL.getAreaBuy(" + val + "," + id + ",'" + dom + "','" + name + "','" + cityName + "')\"  class='pl20'>" + cityName + "</li>");        }        newStr.push("</ul></div>");        $("body .dqld_div").remove();        $("body").append(newStr.join(""));        var height = $(window).height();        $(".dqld_div").css("height", height + "px");    }    function getAreaBuy(val, val1, dom, name1, name2) {        var proStr = selectArea(val1);        var newStr = new Array();        newStr.push("<div class=\"dqld_div\"><ul>");        newStr.push("<li onclick=\"FL.getProvinceBuy()\" class='bck-one'>" + name1 + "</li>");        newStr.push("<li onclick=\"FL.getCityBuy(" + val1 + ")\" class='pl20 bck-two'>" + name2 + "</li>");        for (var t = 0; t < proStr.length; t++) {            var id = proStr[t].area_id;            var areaName = proStr[t].area_name;            newStr.push("<li  class='pl30' onclick=\"FL.getallArea(" + val + "," + val1 + "," + id + ",'" + dom + "','" + name1 + "','" + name2 + "','" + areaName + "')\">" + areaName + "</li>");        }        newStr.push("</ul></div>");        if (proStr.length == 0) {            var allarea = name1 + '>' + name2;            $(dom).attr({                "SS": val,                "city_id": val1,                "area_id": ""            });            $(dom).val(allarea);            $("body .dqld_div").remove();            removeShade();        } else {            $("body .dqld_div").remove();            $("body").append(newStr.join(""));        }        var height = $(window).height();        $(".dqld_div").css("height", height + "px");    }    function getallArea(val, val1, val2, dom, name1, name2, name3) {            var allarea = name1 + '>' + name2 + '>' + name3;            $(dom).attr({                "SS": val,                "city_id": val1,                "area_id": val2            });            $(dom).val(allarea);            $("body .dqld_div").remove();            $("body").css("overflow", "auto");            removeShade();        }        //fastClick        /*添加页面遮罩*/    function addShade() {    		var htmlHeight = document.body.scrollHeight || document.documentElement.scrollHeight;            $("body").append('<div class="loading-shade"></div>');            $(".loading-shade").css("height",htmlHeight+"px");        }        /*删除页面遮罩*/    function removeShade() {            $(".loading-shade").remove();        }        /*页面遮罩点击关闭弹出层         * dom=>#id         * type => hide || remove         * */    function closeDiv(dom, type) {            $(".loading-shade").click(function() {                type == "hide" ? $(dom).hide() : $(dom).remove();                $(".loading-shade").remove();            })        }        /*地区查询*/    function selectArea(id) {            var result;            if (id) {                var newData = {                    pid: id,                    flag: "wap"                };            } else {                var newData = {                    flag: "wap"                };            }            $.ajax({                type: "get",                async: false,                url: WapSiteUrl + '/api/index.php?act=common_index&op=get_area_list',                data: newData,                dataType: "json",                success: function(data) {                    result = data.result;                }            });            return result;        }        //获取验证码    function getCode(number,hashSecode,captchaNum) {            $.ajax({                type: 'get',                url: WapSiteUrl + "/api/index.php?act=common_index&op=get_phone_code",                data: {number: number,flag: "wap",nchash:hashSecode,captcha:captchaNum},                dataType: 'json',                success: function(result) {                    if (result.error === "0") {                    }else{                    	layer.msg(result.msg);                    }                },                error: function(xhr) {                }            });        }       	//获取商品分类	function goodsClass(pid,area,load){		var data ;		if(pid!==""){			data = {pid :pid,area:area,flag:"wap"};		}else{			data ={area:area,flag:"wap"};		}		$.ajax({			type:'get',       	    url:WapSiteUrl+'/api/index.php?act=common_goods&op=get_goods_class',       	    data:data,       	    dataType:'json',       	    success:function(data){       	    	load.success(data);       	    },       	    error:function(xhr){       	    	       	    },       	    complete:function(xhr){       	    	       	    }		})	}	//删除收货地址	function deleteAddress(id){		$.ajax({			type:'post',       	    url:WapSiteUrl+'/api/index.php?act=buyer_delivery&op=del_address',       	    data:{mid:FL.mid,token:FL.token,flag:"wap",address_id:id},       	    dataType:'json',       	    success:function(data){       	    	if(data&&data.error==="0"){       	    		layer.msg("地址已删除");       	    	}       	    },       	    error:function(xhr){       	    	       	    },       	    complete:function(xhr){       	    	       	    }		});	}	//添加收藏方法	function addFavorite(id,type){		$.ajax({			type:'post',       	    url:WapSiteUrl+'/api/index.php?act=buyer_favorite&op=add_favorites',       	    data:{mid:FL.mid,token:FL.token,flag:"wap",fid:id,type:type},       	    dataType:'json',       	    success:function(data){       	    	if(data&&data.error==="0"){       	    		layer.msg("收藏成功");       	    	}       	    },       	    error:function(xhr){       	    	       	    },       	    complete:function(xhr){       	    	       	    }		});	}	//删除收藏	function deleteFavorite(id,type){		$.ajax({			type:'post',       	    url:WapSiteUrl+'/api/index.php?act=buyer_favorite&op=delete_favorites',       	    data:{mid:FL.mid,token:FL.token,flag:"wap",fid:id,type:type},       	    dataType:'json',       	    success:function(data){       	    	if(data&&data.error==="0"){       	    		layer.msg("收藏已删除");       	    	}       	    },       	    error:function(xhr){       	    	       	    },       	    complete:function(xhr){       	    	       	    }		});	}	//添加浏览历史	function addLibrary(id){		$.ajax({			type:'post',       	    url:WapSiteUrl+'/api/index.php?act=buyer_browse&op=add_browse',       	    data:{mid:FL.mid,token:FL.token,flag:"wap",id:id},       	    dataType:'json',       	    success:function(data){       	    	if(data&&data.error==="0"){       	    	}       	    },       	    error:function(xhr){       	    	       	    },       	    complete:function(xhr){       	    	       	    }		});	}	//判断用户是否登录,未登录跳到登录页	function  judgeLogin(){		layer.load(1, {            shade: [0.5, '#000000'] //0.1透明度的白色背景        });		var token = getcookie("token");		if(!token){			location.href="../login/login.html";		}		$(".layui-layer-shade").remove();        $(".layui-layer-loading").remove();	}    function getCityByBaiduCoordinate(rs) {      	var province = rs.addressComponents.province.slice(0,rs.addressComponents.province.length-1);    	var city = rs.addressComponents.city.slice(0,rs.addressComponents.city.length-1);    	addcookie("province",province);    	addcookie("city",city);    	addcookie("road",rs.addressComponents.district+rs.addressComponents.street+rs.addressComponents.streetNumber||"");    	$("#gps1").html(province+" · "+city);    	$("#gps2").html(rs.addressComponents.district+rs.addressComponents.street+rs.addressComponents.streetNumber||"");    }	function getGps(){		var geolocation = new BMap.Geolocation();		geolocation.getCurrentPosition(function(r){			if(this.getStatus() == BMAP_STATUS_SUCCESS){				var x =r.point.lng;				var y =r.point.lat;				var ggPoint = new BMap.Point(x,y);				var geoc = new BMap.Geocoder();        		    geoc.getLocation(ggPoint, getCityByBaiduCoordinate);			}			else {			}        		},{enableHighAccuracy: true})	}		//获取购物车数量	function getCartGoodsNum(mid,token,load){		$.ajax({			type:'get',       	    url:WapSiteUrl+'/api/index.php?act=buyer_cart&op=list',       	    data:{mid:mid,token:token,flag:"wap",type:"db",area:2},       	    dataType:'json',       	    success:function(data){       	    	load.success(data);       	    },       	    error:function(xhr){       	    	       	    },       	    complete:function(xhr){       	    	       	    }		})	}	//搜索框点击跳转到搜索页	function  goSearch(e){		$(e).click(function(){	     location.href='../index/search.html';        });	}		//获取个人购物车数量	function  getGoodsNum(load){		$.ajax({
			type:"post",
			url:WapSiteUrl+'/api/index.php?act=buyer_cart&op=goods_count',			data:{mid:FL.mid,token:FL.token,flag:"wap"},			dataType:"json",			success:function(data){       	    	load.success(data);       	    },       	    error:function(xhr){       	    	       	    },       	    complete:function(xhr){       	    	       	    }
		});	}    //把函数注册到命名空间中      window['FL']['isWeiXin'] = isWeiXin; //判断是否微信浏览器    window['FL']['getScrollTop'] = getScrollTop; //获取滚动条当前位置    window['FL']['getClientHeight'] = getClientHeight; //获取当前可视范围的高度    window['FL']['scrollEndLoad'] = scrollEndLoad; //获取当前可视范围的高度    window['FL']['buildUrl'] = buildUrl; //获取当前可视范围的高度    window['FL']['formatStr'] = formatStr; //字符串格式化（占位符替换）    window['FL']['valid'] = valid; //表单验证（占位符替换）    window['FL']['toTop'] = toTop; //回到顶部    window['FL']['subStrLen'] = subStrLen; //字符串截取，如超出长度以“...”替换    window['FL']['isEmptyObject'] = isEmptyObject; //判断对象(json)是否为空    window['FL']['countDown'] = countDown; //获取验证码倒计时    window['FL']['getProvinceBuy'] = getProvinceBuy; //获地区联动    window['FL']['getCityBuy'] = getCityBuy;    window['FL']['getAreaBuy'] = getAreaBuy;    window['FL']['getallArea'] = getallArea;    window['FL']['addShade'] = addShade; //添加遮罩    window['FL']['removeShade'] = removeShade; //删除遮罩    window['FL']['closeDiv'] = closeDiv; //关闭弹出层.    window['FL']['getCode'] = getCode; //获取验证码    		window['FL']['goodsClass'] = goodsClass; //获取商品分类		window['FL']['deleteAddress'] = deleteAddress; //删除收货地址		window['FL']['addFavorite'] = addFavorite; //添加收藏		window['FL']['deleteFavorite'] = deleteFavorite; //删除收藏		window['FL']['addLibrary'] = addLibrary; //添加浏览历史		window['FL']['judgeLogin'] = judgeLogin; //判断用户是否登录		window['FL']['getGps'] = getGps; //获取地理位置信息		window['FL']['getCartGoodsNum'] = getCartGoodsNum; //获取购物车数量	
	window['FL']['goSearch'] = goSearch; //跳转搜索页面		window['FL']['getGoodsNum'] = getGoodsNum;//获取购物车数量(页面显示个数用)})();$(function(){	FL.toTop(1);})