$(function(){function e(e){window.WebViewJavascriptBridge?e(WebViewJavascriptBridge):document.addEventListener("WebViewJavascriptBridgeReady",function(){e(WebViewJavascriptBridge)},!1)}function t(e){$.ajax({type:"get",url:WapSiteUrl+"/api/index.php?act=buyer_activity&op=get_activity_detail",data:{activity_id:e,type:"hongbao",flag:"wap",dmid:5},dataType:"json",success:function(e){if(e&&0==e.error){$("title,.header-title").text(e.result.activity_title),$(".banner").attr("src",e.result.activity_banner),template.helper("parseFloat",parseFloat);var t=template.render("floor_tpl",e);$("#floor").html(t),addcookie("batchs_id",e.result.coupon_batchs[0]);var n=e.result.share_title,a=e.result.share_desc,o=e.result.share_img,c=window.location.href;i(n,a,o,c),FL.wxShare(n,a,c,o),$("#floor li").click(function(){var t=$(this).attr("data-id");"0"==native_flag||"1"==native_flag?location.href="../shopping/goods_details.html?goods_id="+t+"&resource_tags="+e.result.resource_tags+"!goodsdetail":"-1"==native_flag&&(location.href="../shopping/goods_details.html?goods_id="+t+"&resource_tags="+e.result.resource_tags)});var r=parseInt($("#floor li").width());$("#floor img").css({width:r+"px",height:r+"px"})}},error:function(e){}})}function n(e,t){$.ajax({type:"get",url:WapSiteUrl+"/api/index.php?act=buyer_coupon&op=get_bag_detail",data:{mid:e,batch_id:t,flag:"wap"},dataType:"json",success:function(e){e&&"0"===e.error&&("1"==e.result.is_gotten?($(".checked").removeClass("none"),$(".oldy,.new").addClass("none")):($(".oldy").removeClass("none"),$(".checked,.new").addClass("none")))}})}function a(){var e={func:"getmember",params:""};d.send(e,function(e){e?($(".checked").removeClass("none"),$(".new").addClass("none"),n(e.member_id,f),$(".oldy").click(function(){s(e.member_id,e.token,f)})):$(".new").click(function(){o()})})}function o(){var e={func:"gotoLogin4Result",params:""};d.send(e,function(e){a()})}function i(t,n,a,o){var i=navigator.userAgent.toLowerCase();i.indexOf("fhmall_android")>0?c(t,n,a,o):i.indexOf("fhmall_ios")>0&&e(function(e){d=e;try{e.init(function(e,t){})}catch(i){}r(t,n,a,o)})}function c(e,t,n,a){var o={title:e,content:t,imgs:n,url:a};FHMall.enableShareButton(JSON.stringify(o))}function r(e,t,n,a){var o={func:"enableshare",params:{title:e,content:t,imgs:n,url:a}};d.send(o)}function s(e,t,n){$.ajax({type:"post",url:WapSiteUrl+"/api/index.php?act=buyer_coupon&op=get_bag",data:{mid:e,token:t,batch_id:n,flag:"wap"},dataType:"json",success:function(n){"0"==n.error&&l(e,t,n.result)}})}function l(e,t,n){$.ajax({type:"post",url:WapSiteUrl+"/api/index.php?act=buyer_coupon&op=get_coupon",data:{mid:e,token:t,bag_id:n,flag:"wap"},dataType:"json",success:function(e){"0"==e.error&&("success"==e.result?(layer.msg("你已经成功领取红包"),$(".checked").removeClass("none"),$(".oldy").addClass("none")):"pending"==e.result&&(layer.msg("手机号还未注册，快去下载app吧"),location.href="http://a.app.qq.com/o/simple.jsp?pkgname=com.fanglin.fenhong.microbuyer"))}})}var d,u=GetQueryString("activity_id");t(u);var f=getcookie("batchs_id");if("0"==native_flag){var p=getMemberInfo();try{p.token}catch(g){}p&&($(".checked").removeClass("none"),$(".new").addClass("none"),n(p.member_id,f),$(".oldy").click(function(){s(p.member_id,p.token,f)})),$(".new").click(function(){FHMall.gotoLogin4Result(function(e){getMemberInfo();$(".checked").removeClass("none"),$(".new").addClass("none"),n(p.member_id,f),$(".oldy").click(function(){s(p.member_id,p.token,f)})})})}else"1"==native_flag?e(function(e){d=e;try{e.init(function(e,t){})}catch(t){}a()}):"-1"==native_flag&&($(".fh-header").removeClass("none"),FL.mid&&($(".checked").removeClass("none"),$(".new").addClass("none"),n(FL.mid,f)),$(".oldy").click(function(){s(FL.mid,FL.token,f)}),$(".new").click(function(){location.href="../login/login.html"}));$(".question").click(function(){$("#mask").show()}),$("#explain").click(function(){$("#mask").show()}),$("#mask,#closebag").click(function(){$("#mask").hide()})});