!function(t){function e(){$.ajax({type:"get",url:WapSiteUrl+"/api/index.php?act=buyer_discovery&op=get_shop_class",data:{flag:"wap"},dataType:"json",success:function(t){if(t&&"0"===t.error){var e=template.render("discoverList",t);$("#discover_list").html(e),$("#discover_list img").lazyload({threshold:200})}},error:function(t){}})}function o(){$.ajax({type:"get",url:WapSiteUrl+"/api/index.php?act=buyer_discovery&op=get_shop_settings",data:{flag:"wap",mid:FL.mid},dataType:"json",success:function(t){t&&"0"===t.error&&($(".img-list").attr("src",t.result.shop_banner_pic),t.result.shop_banner_url&&$(".img-list").click(function(){location.href=t.result.shop_banner_url}))},error:function(t){}})}function i(t){if(t&&0==t.error&&0!=t.result.num){t.result.num>99&&(t.result.num="99+");var e='<span class="cart-num">'+t.result.num+"</span>";$(".shoppingurl").after(e),"1"==t.result.is_global?$(".shoppingurl").prop("href","../shopping/shopping_cart_global.html"):$(".shoppingurl").prop("href","../shopping/shopping_cart_cn.html")}}function a(t,e,o){FL.ajaxDate("get",get_found_home,{mid:FL.mid,num:t,curpage:e},function(t){if(t&&"0"==t.error){var e=template("discover-tmpl",t);"yes"==o?$("#discoverCentent").html(e):$("#discoverCentent").append(e);for(var i=0;i<t.result.length;i++)try{new Swiper(".timeListMedia"+i+" .swiper-container",{loop:!0,effect:"fade",autoplay:6e3,pagination:".timeListMedia"+i+" .swiper-pagination"})}catch(a){}console.log(t);for(var r=0;r<t.result.length;r++)for(var d=0;d<t.result[r].images.length;d++)if(t.result[r].images[d].goods){var p=document.getElementById("myCanvas_"+r+"_"+d),u=t.result[r].images[d].goods,f=$(window).width();p.width=f,p.height=f;for(var m=0;m<u.length;m++){var g=u[m].location.split(",");x=parseFloat(g[0])*f,y=parseFloat(g[1])*f;var h=u[m].line1.value,v=u[m].line2.value,_=u[m].line3.value,T=u[m].line1.direction;if(c(p,x,y,h,v,_,T),"R"==T)var w='<a class="goodsLink" style="top:'+(y-45)+"px;left:"+x+'px;" href="../shopping/goods_details.html?goods_id='+u[m].goods_id+"&talent_deductid="+t.result[r].images[d].talent_deductid+'"></a>';else var w='<a class="goodsLink" style="top:'+(y-45)+"px;left:"+(x-130)+'px;" href="../shopping/goods_details.html?goods_id='+u[m].goods_id+"&talent_deductid="+t.result[r].images[d].talent_deductid+'"></a>';$("#myCanvas_"+r+"_"+d).after(w)}}$("canvas").on("click",function(){var t=this;"0"==$(t).css("opacity")?($(t).parent("div").find(".goodsLink").show(),$(t).css("opacity","1")):($(t).parent("div").find(".goodsLink").hide(),$(t).css("opacity","0"))});for(var d=0;d<t.result.length;d++)try{new IScroll(".f-nav-stickytabs"+d,{scrollX:!0,scrollY:!1,mouseWheel:!0,tab:!0})}catch(a){}$(".collect_count").click(function(){FL.judgeLogin();var t=this,e=parseFloat($(t).attr("collect_count")),o=$(t).attr("time_id");$(t).hasClass("collected")?l(o,"time",t,e):s(o,"time",t,e)}),$(".comment_count").click(function(){FL.judgeLogin();var t=$(this).attr("time_id");location.href="../specialty/time_detail.html?time_id="+t+"&comment_count=true"}),$(".shareBtn").click(function(){var t=this;$(".-mob-share-ui").show();var e=$(t).attr("goods_name"),o=$(t).attr("goods_desc"),i=$(t).attr("goods_url"),a=$(t).attr("goods_image"),n=$(t).attr("time_id");FL.share(e,o,a,i,"","",0,n,"time")}),n()}})}function n(){$(window).scroll(function(){var t=document.body.scrollHeight||document.documentElement.scrollHeight,e=document.body.clientHeight||document.documentElement.clientHeight,o=document.body.scrollTop||document.documentElement.scrollTop;if(o+e==t){var i=$(".timeListMedia").length;p=i/10+1,f!=p&&u.test(p)&&(a(d,p,"no"),f=p)}})}function l(t,e,o,i){$.ajax({type:"post",url:WapSiteUrl+"/api/index.php?act=buyer_favorite&op=delete_favorites",data:{flag:"wap",token:FL.token,mid:FL.mid,fid:t,type:e},dataType:"json",success:function(t){t&&"0"===t.error&&($(o).removeClass("collected"),$(o).find("img").attr("src","../../images/wap/specialty/collect.png"),"1"==i?$(o).find("span").text("收藏"):$(o).find("span").text(i-1),$(o).attr("collect_count",i-1))}})}function s(t,e,o,i){$.ajax({type:"post",url:WapSiteUrl+"/api/index.php?act=buyer_favorite&op=add_favorites",data:{flag:"wap",token:FL.token,mid:FL.mid,fid:t,type:e},dataType:"json",success:function(t){t&&"0"===t.error&&($(o).addClass("collected"),$(o).find("img").attr("src","../../images/wap/specialty/collected.png"),i++,$(o).find("span").text(i),$(o).attr("collect_count",i))}})}function r(){$.ajax({url:WapSiteUrl+"/api/index.php?act=common_index&op=function_switch",type:"get",data:{flag:"wap"},async:!1,dataType:"json",success:function(t){t&&t.error&&("discover"==t.result[1].name&&(t.result[1].type.indexOf("wap")>=0||t.result[1].type.indexOf("all")>=0)?($("#discover").removeClass("none"),o(),e()):($("#discover_index").removeClass("none"),a(10,1,"yes")))}})}function c(t,e,o,i,a,n,l){if(t.getContext){var s=t.getContext("2d");s.beginPath(),s.strokeStyle="white","R"==l?(s.moveTo(e,o),s.lineTo(e+100,o),s.moveTo(e,o-30),s.lineTo(e+130,o-30),s.moveTo(e,o+30),s.lineTo(e+130,o+30),s.fillStyle="#fff",s.fillText(i,e+10,o-40),s.fillText(a,e+10,o-10),s.fillText(n,e+10,o+20)):"L"==l&&(s.moveTo(e,o),s.lineTo(e-100,o),s.moveTo(e,o-30),s.lineTo(e-130,o-30),s.moveTo(e,o+30),s.lineTo(e-130,o+30),s.fillStyle="#fff",s.fillText(i,e-80,o-40),s.fillText(a,e-80,o-10),s.fillText(n,e-80,o+20)),s.moveTo(e,o-30),s.lineTo(e,o+30),s.stroke(),s.closePath(),s.beginPath(),s.arc(e,o,10,0,2*Math.PI,!1),s.closePath(),s.fillStyle="rgba(0, 0, 0, 0.2)",s.fill(),s.beginPath(),s.arc(e,o,5,0,2*Math.PI,!1),s.closePath(),s.fillStyle="#fff",s.fill()}}getcookie("province"),getcookie("city"),getcookie("road");FL.getGoodsNum({success:i});var d=10,p=1,u=/^[-]{0,1}[0-9]{1,}$/,f=0,m=function(){this.onLoad=function(){r()}};t.Activity=t.Activity||{},Activity.Discover=new m}(this);