!function($,w,d){"use strict";check_login();var fl=!0,token=FL.token,mid=FL.mid;$(function(){$.ajax({type:"get",url:WapSiteUrl+"/api/index.php?act=common_store_joinin&op=company_info",data:{mid:mid,token:token,flag:"wap"},dataType:"json",success:function(data){if("0"===data.error){"2"===data.result.step?location.href="information.html":"1"!==data.result.step&&(location.href="payment.html");var html=template.render("company_info_tpl",data.result);$("#company_info").append(html),$("#licence-pic").attr("src")&&$("#licence-pic").show(),$("#identity-pic").attr("src")&&$("#identity-pic").show();var txt="",valtxt="",that=null,itemid="",pid=0,cid=0,val="";$(".item").click(function(){return $(".page-layout").height($(w).height()),$(".page").show().animate({left:0,opacity:1}),$("html,body").animate({scrollTop:"0px"},200),that=$(this),txt=$(this).find("span").text(),valtxt=$(this).find("label").text(),$("section .info").hide(),!txt||$(this).find("span").hasClass("red")?($(".ming input").val(""),$(".ming input").attr("placeholder","请填写"+valtxt)):$(".ming input").attr("value",txt),$(".ming input").click(function(){$(this).hasClass("red")&&$(this).val("").removeClass("red")}),"公司所在地"==valtxt?($(".city").show(),$(".ming").hide()):($(".city").hide(),$(".ming").show()),!1}),$.ajax({type:"get",url:WapSiteUrl+"/api/index.php?act=common_index&op=get_area_list",data:{pid:"0",flag:"wap"},dataType:"json",success:function(t){if("0"==t.error)for(var e=t.result.length,i=0;i<e;i++)$("#s_province").append("<option area_id="+t.result[i].area_id+">"+t.result[i].area_name+"</option>")}}),$("#s_province,#s_city").change(function(){var t=$(this).attr("id"),e=$(this).parent().next().find("select").attr("id");pid=$("#"+t+" option:selected").attr("area_id"),$.ajax({type:"get",url:WapSiteUrl+"/api/index.php?act=common_index&op=get_area_list",data:{pid:pid,flag:"wap"},dataType:"json",success:function(t){if("0"==t.error){var i=t.result.length;$("#"+e).html('<option value="">请选择...</option>');for(var a=0;a<i;a++)$("#"+e).append("<option area_id="+t.result[a].area_id+">"+t.result[a].area_name+"</option>")}}})}),$(".success").click(function(){if($("p.error").hide(300),$(".ming input").click(function(){$("p.error").hide(300)}),itemid=that.find("span").attr("id"),"company_address"==itemid){if("请选择省份..."==$("#s_province option:selected").text()||"请选择城市..."==$("#s_city option:selected").text()||"请选择地区..."==$("#s_county option:selected").text())return $(".ming").text("请正确选择公司所在地"),!1;val=$("#s_province option:selected").text()+" "+$("#s_city option:selected").text()+" "+$("#s_county option:selected").text()}else val=$(".ming input").val();if(!val||"请填写"+valtxt==$(".ming input").attr("value"))return $(".ming input").val("请填写"+valtxt),$(".ming input").addClass("red"),!1;if("contacts_phone"==itemid&&!/^1[1-9][0-9]\d{8}$/.test(val))return $("p.error").show(300),$("p.error").text("* 请填写正确的联系人电话"),!1;if("contacts_email"==itemid){var filter=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(!filter.test(val))return $("p.error").show(300),$("p.error").text("*请填写正确的邮箱"),!1}if("identity_code"==itemid){var re=/^(\d{15}$|^\d{18}$|^\d{17}(\d|X|x))$/;if(!re.test(val))return $("p.error").show(300),$("p.error").text("*请填写正确的身份证号"),!1}var data=eval('({key:"'+key+'",mid:"'+mid+'",'+itemid+':"'+val+'",flag: "wap"})');return $.ajax({type:"post",url:WapSiteUrl+"/api/index.php?act=common_store_joinin&op=company_info_save",data:data,dataType:"json",success:function(t){"0"===t.error&&($(".page").hide(),$("#"+itemid).text(val).removeClass("red"),that.find("span").text(val),fl=!0)}}),$(".page").hide(),!1}),$("#page .back").click(function(){$(".page").animate({left:"-800px",opacity:0}),$(".city").hide()}),$("#business_licence_number_electronic,#identity_code_electronic").change(function(){var t=$(this).attr("id"),e=new FormData;return e.append("token",token),e.append("mid",mid),e.append("flag","wap"),e.append(t,$(this)[0].files[0]),swal({title:"",text:"正在努力上传...",imageUrl:"../images/preloader.gif",showConfirmButton:!1}),$.ajax({type:"post",url:WapSiteUrl+"/api/index.php?act=common_store_joinin&op=company_info_save",data:e,processData:!1,contentType:!1,dataType:"json",success:function(e){"0"==e.error?(swal("","上传成功！","success"),$("#"+t).closest(".pic").find("img").attr("src",e.result).show(),fl=!0):(swal("","上传失败，请重试~","error"),fl=!1)}}),!1}),$(".next").click(function(){var t=$(".pic").eq(0).find("img").attr("src"),e=$(".pic").eq(1).find("img").attr("src");return $(".item span").each(function(t,e){""!==$(e).text()&&"请完善此处信息"!==$(e).text()||($(e).text("请完善此处信息").addClass("red"),fl=!1)}),t?e?$(".checkbox").attr("checked")?fl?!!fl&&(swal({title:"",text:"信息一旦确定不可修改，你确定吗？",type:"warning",showCancelButton:!0,cancelButtonText:"取消",confirmButtonColor:"#DD6B55",confirmButtonText:"确定",closeOnConfirm:!1},function(){$.ajax({type:"post",url:WapSiteUrl+"/api/index.php?act=common_store_joinin&op=company_info_submit",data:{token:token,mid:mid,flag:"wap"},dataType:"json",success:function(t){"0"==t.error&&(location.href="information.html")}})}),!1):(swal("","您的信息不完善请继续填写","info"),!1):(swal("","您还未同意供应商入驻协议","info"),!1):(swal("","请上传身份证电子版","info"),fl=!1,!1):(swal("","请上传营业执照电子版","info"),fl=!1,!1)}),$(".agreement").click(function(){layer.open({type:2,title:"供应商入驻协议",shadeClose:!0,shade:.8,area:["75%","80%"],content:"terms.html"})})}}})})}($,window,document);