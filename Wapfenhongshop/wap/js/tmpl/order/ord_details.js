!function(t){function e(){$.ajax({type:"post",url:WapSiteUrl+"/api/index.php?act=buyer_order&op=get_order_detail",data:{token:FL.token,mid:FL.mid,order_id:g,flag:"wap"},dataType:"json",success:function(t){if(t&&"0"==t.error){var e=t.result;console.log(t);var s=template.render("my_address",e.reciver_info);$("#myAddress").empty(),$("#myAddress").html(s);var n=template.render("goods_details",t);$("#goods-list").empty(),$("#goods-list").html(n),i(e),_(g),o(e),a(e),p(e.pay_sn),l(),r(e)}},error:function(t){}})}function i(t){var e=/[\u4e00-\u9fa5]/g,i=t.state_desc.match(e);if(t.pintuan_state&&0!=t.pintuan_id?"0"==t.pintuan_state?$("#state").text("拼团中 等待付款"):"1"==t.pintuan_state?$("#state").text("拼团中"):"2"==t.pintuan_state?$("#state").text("拼团成功，等待发货"):"3"==t.pintuan_state&&$("#state").text("拼团失败，退款中"):($("#state").text(i.join("")),50==t.order_state&&$("#state").text("交易失败")),grouphref="../activity/groupdetail.html?pintuan_group_id="+t.pintuan_group_id+"&pintuan_parent_id="+t.pintuan_parent_id,$("#grouphref").prop("href",grouphref),7==h?$("#state").text("退款/退货成功"):1!=h&&2!=h&&3!=h&&4!=h&&5!=h&&6!=h||$("#state").text("售后申请处理中"),$("#order_sn").text(t.order_sn),"0"!=t.validity_pay_time)var o=t.validity_pay_time,a=setInterval(function(){o--,$("#validity_pay_time span").text(parseInt(o/3600)+"时"+parseInt(o%3600/60)+"分"+o%60+"秒"),o<=0&&(clearInterval(a),$("#validity_pay_time").text("由于长时间未付款,订单已经自动取消"))},1e3);else $("#validity_pay_time").text("由于长时间未付款,订单已经自动取消");t.order_state>10&&50!=t.order_state?(o=FL.dateFormat(t.payment_time),$("#validity_pay_time").text("支付时间："+o)):0==t.order_state&&$("#validity_pay_time").hide(),$(".baidustore").click(function(){t.store_baidusales?location.href="../shopping/store_baidusales.html?store_baidusales="+t.store_baidusales:layer.msg("卖家家不在线，请稍后联系")}),20==t.order_state&&$(".refund").css("display","inline-block"),$(".refund").click(function(){1===t.refund_enabled&&20==t.order_state?location.href="../refund/apply_service.html?order_id="+t.order_id+"&way=1&goods_num="+t.order_goods[0].goods_num:layer.msg("订单中商品不支持退款，如有疑问请联系卖家")})}function o(t){$("#express_price").text("￥"+t.shipping_fee),0!=t.country_source&&($("#duty").show(),null==t.duty_fee?$("#duty_price").text("￥0.00"):$("#duty_price").text("￥"+t.duty_fee)),$("#privilege_price").text(t.coupon_amount.toFixed(2)),t.pd_amount&&$("#yu_price").text(t.pd_amount.toFixed(2)),$("#total_price").text("￥"+t.real_amount.toFixed(2)),"10"==t.order_state&&$("#totaltext").text("应付金额"),t.mansong&&$("#shop_free span.fh-black").text(t.mansong.minus_amount),0!=t.order_state&&$("#tickets").show()}function a(t){0==t.order_state?$(".detail_btn").html('<a class="btn-shopping fh-bg-yellow" order_id="'+t.order_id+'" id="del_order">删除订单</a>'):10==t.order_state?"0"==t.pintuan_state&&0!=t.pintuan_id?$(".detail_btn").html('<a class="btn-shopping unweixin pintuanbuy" id="pay_money" pay_sn="'+t.pay_sn+'"pay_amount="'+t.real_amount+'" country_source="'+t.country_source+'">立即付款</a>'):0==t.validity_pay_time?$(".detail_btn").html('<a class="btn-shopping fh-bg-yellow" order_id="'+t.order_id+'" id="cancle_order">取消订单</a>'):$(".detail_btn").html('<a class="btn-shopping unweixin" id="pay_money" pay_sn="'+t.pay_sn+'"pay_amount="'+t.real_amount+'" country_source="'+t.country_source+'">立即付款</a><a class="btn-shopping fh-bg-yellow btn_right" order_id="'+t.order_id+'" id="cancle_order">取消订单</a>'):20==t.order_state?t.pintuan_id?"1"==t.pintuan_state?$(".detail_btn").html('<a class="pintuanbuy btn-shopping" href="../activity/groupdetail.html?pintuan_group_id='+t.pintuan_group_id+"&pintuan_parent_id="+t.pintuan_parent_id+'">查看团详情</a>'):"2"==t.pintuan_state?$(".detail_btn").html('<a class="pintuanbuy btn-shopping" href="../logistics/logistics.html?order_id='+t.order_id+"&shipping_code="+t.shipping_code+'">订单跟踪</a>'):"3"==t.pintuan_state&&$(".detail_btn").html('<a class="pintuanbuy" order_id="'+t.order_id+'" id="del_order">删除订单</a>'):$(".detail_btn").html('<a class="btn-shopping" href="../logistics/logistics.html?order_id='+t.order_id+"&shipping_code="+t.shipping_code+'">订单跟踪</a>'):30==t.order_state?$(".detail_btn").html('<a class="btn-shopping receipt" order_id="'+t.order_id+'">确认收货</a><a class="btn-shopping fh-bg-yellow btn_right" href="../logistics/logistics.html?order_id='+t.order_id+"&shipping_code="+t.shipping_code+'">订单跟踪</a>'):40==t.order_state&&("0"==t.evaluation_state?$(".detail_btn").html('<a class="btn-shopping" href="../order/evaluation_guide.html?order_id='+t.order_id+'">去评价</a><a class="btn-shopping fh-bg-yellow btn_right" href="../logistics/logistics.html?order_id='+t.order_id+"&shipping_code="+t.shipping_code+'">订单跟踪</a>'):"1"==t.evaluation_state?$(".detail_btn").html('<a class="btn-shopping" href="../shopping/evaluation.html?if_append_evaluate=1&order_id='+t.order_id+'">追加评价</a><a class="btn-shopping fh-bg-yellow btn_right" href="../logistics/logistics.html?order_id='+t.order_id+"&shipping_code="+t.shipping_code+'">订单跟踪</a>'):$(".detail_btn").html('<a class="btn-shopping fh-bg-yellow btn_right" order_id="'+t.order_id+'" id="del_order">删除订单</a><a class="btn-shopping" href="../logistics/logistics.html?order_id='+t.order_id+"&shipping_code="+t.shipping_code+'">订单跟踪</a>'))}function r(t){for(var e=$("#goods-list").find(".container"),i=0,o=parseFloat("0.00"),a=parseFloat("0.00"),r=parseFloat("0.00"),s=parseFloat($("#privilege_price").text()),n=0;n<e.length;n++){var d=$(e[n]).find(".goods-price").text().slice(1),p=$(e[n]).find(".module-num").text().slice(1);e.attr("hs_rate");i+=parseInt(p),r=parseFloat($("#duty_price").text()),a+=parseFloat(d*p)}o=a+parseFloat($("#express_price").text().slice(1))+s,$("#total_num").html("共 "+i+" 件"),"0"==t.country_source?$("#real_price").html("￥"+a):$("#real_price").html("￥"+a.toFixed(2))}function s(t,e){$.ajax({url:WapSiteUrl+"/api/index.php?act=buyer_order&op=receive_order",type:"post",dataType:"json",data:{flag:"wap",token:FL.token,mid:FL.mid,order_id:t},success:function(t){"0"===t.error&&($("#mask").hide(),$("#goods_receipt").hide(),setTimeout(function(){location.reload()},300))}})}function n(t,e,i){$.ajax({url:WapSiteUrl+"/api/index.php?act=buyer_order&op=cancle_order",type:"post",dataType:"json",data:{flag:"wap",token:FL.token,mid:FL.mid,msg:e,order_id:t},success:function(t){"0"===t.error&&($("#mask").hide(),$("#maskbox").hide(),i.hide(),layer.msg("取消成功"),setTimeout(function(){location.reload()},500))}})}function d(t){$.ajax({url:WapSiteUrl+"/api/index.php?act=buyer_order&op=delete_order",type:"post",dataType:"json",data:{flag:"wap",token:FL.token,mid:FL.mid,order_id:t},success:function(t){"0"===t.error&&($("#mask").hide(),$("#maskbox").hide(),layer.msg("删除成功"),setTimeout(function(){history.back()},1e3))}})}function p(t){$.ajax({url:WapSiteUrl+"/api/index.php?act=buyer_coupon&op=paid_coupon_batch",type:"post",dataType:"json",data:{flag:"wap",token:FL.token,mid:FL.mid,pay_sn:t},success:function(t){if("0"===t.error){var e=t.result;e.batch_id&&e.batch_name&&($("#bag_detail").removeClass("none"),$("#num").text(e.bag_num)),FL.wxShare(e.share_title,e.share_desc,e.share_url,e.share_img,e.share_desc)}}})}function _(t){$.ajax({type:"post",url:WapSiteUrl+"/api/index.php?act=buyer_order&op=get_order_detail",data:{token:FL.token,mid:FL.mid,order_id:t,flag:"wap"},dataType:"json",success:function(t){if(t&&"0"==t.error){var e=template("goods_suit_tmpl",t.result);$("#goods_suit").html(e);for(var i=t.result,o=0,a=0;a<i.order_goods.length;a++)if(i.order_goods[a].bundling){for(var r=0;r<i.order_goods[a].bundling.bl_list.length;r++)o+=parseFloat(i.order_goods[a].bundling.bl_list[r].down_price);o=o.toFixed(2);var s=parseFloat(i.order_goods[a].bundling.bl_price);$("#downPrice").text("立省 ￥"+o+"元"),$("#totalpricedel").text("￥"+(parseFloat(o)+parseFloat(s)).toFixed(2))}}}})}function l(){$("#bag_detail").click(function(){$("#maskbag").show()}),$("#imglist_tao").click(function(){$("#goods_suit").show();var t=document.body.clientHeight;$("#goods_suit").css("height",t+Number(50,10)+"px");var e=t-48;$("body").css("overflow","hidden"),$("#goodsscroll").css({height:e+"px",overflow:"scroll"}),$(".taogoback").click(function(){$("#goods_suit").hide(),$("body").css("overflow","auto")})}),$(".pay-chose").click(function(){var t=this;$(".pay-chose").attr("class","icon-circle-blank pay-chose"),$(t).attr("class","icon-ok-sign pay-chose")}),$(".new-packet-x,#maskbag").click(function(){$("#maskbag").hide(),$(".native_tip").hide()}),$("#cover").click(function(){FL.isWeiXin()?$("#covershare").show():$(".native_tip").show(),event.stopPropagation()}),$("#covershare").click(function(){$("#covershare").hide()}),$("#pay_money").click(function(){c=$(this).attr("pay_sn"),u=$(this).attr("pay_amount"),FL.isWeiXin()&&0!=$(this).attr("country_source")?location.href="order_pay.html?pay_sn="+c+"&pay_amount="+u+"&payment=zfb":location.href="order_pay.html?pay_sn="+c+"&pay_amount="+u}),$("#no_wxpay").click(function(){$("#no_wxpay").hide()}),$("#cancle_order").click(function(){$("#mask").show(),$("#maskbox").show(),g=$(this).attr("order_id"),that=$(this).parents("div.media");var t=($(window).width()-$("#maskbox").width())/2,e=($(window).height()-$("#maskbox").height())/2;$("#maskbox").css({left:t+"px",top:e+"px"})}),$("#mask").click(function(){$("#mask").hide(),$("#maskbox").hide()}),$("#maskbox p").click(function(){msg=$(this).text(),n(g,msg,that)}),$("#del_order").click(function(){g=$(this).attr("order_id"),d(g)}),$(".receipt").click(function(){var t=$(this).attr("order_id");$("#mask").show(),$("#goods_receipt").show();var e=$(this).parents(".media"),i=($(window).width()-$("#goods_receipt").width())/2-40,o=($(window).height()-$("#goods_receipt").height())/2;$("#goods_receipt").css({left:i+"px",top:o+"px"}),$("#goods_ok").click(function(){s(t,e)})}),$(".cancle_receipt,#mask").click(function(t){$("#mask").hide(),$("#goods_receipt").hide()})}var c,u,h=GetQueryString("progress"),g=GetQueryString("order_id"),m=function(){this.onLoad=function(){e()}};t.Goods=t.Goods||{},Goods.Confirmation=new m}(this);