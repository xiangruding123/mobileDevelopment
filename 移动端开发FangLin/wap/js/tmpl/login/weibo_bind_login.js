!function(e){function o(){$("#registerForm").validate({rules:{mobile:{required:!0,telephone:!0},code:"required"},messages:{mobile:{required:"手机号不能为空！",telephone:"请填写正确的手机号"},code:"验证码必填"},errorPlacement:function(e,o){var t=e.text(),i='<div class="tooltip-top" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-in">'+t+"</div></div>";$(".tooltip-top").remove(),o.before(i)}})}function t(){$("#getCode").click(function(){var e=$("input[name='mobile']").val();if(/^1[3|4|5|7|8|9][0-9]\d{4,8}$/.test(e)&&/^1\d{10}$/.test(e)&&!$("input[name='mobile']").hasClass("error")){var o=$("#mobile").val();FL.checkSecode($.trim($("#secode").val()),o,"getCode")}else layer.msg("请输入符合规则的手机号！")}),$("#next_step").click(function(){$("#registerForm").valid()&&i()})}function i(){var e=$("input[name='code']").val(),o=$("input[name='mobile']").val();$.ajax({type:"post",url:WapSiteUrl+"/api/index.php?act=common_member&op=check_phone_code",data:{num:o,code:e,flag:"wap"},dataType:"json",success:function(e){"0"===e.error?a(o):layer.msg(e.msg)},error:function(e){}})}function r(e){var o=$("input[name='code']").val();$.ajax({type:"post",url:WapSiteUrl+"/api/index.php?act=common_member&op=third_bind",data:{info:d,type:m,flag:"wap",mobile:e,code:o},dataType:"json",success:function(e){if(e&&0==e.error){addcookie("member_name",e.result.member_name),addcookie("mid",e.result.member_id),addcookie("token",e.result.token),addcookie("member_mobile",e.result.member_mobile),addcookie("store_id",e.result.store_id),addcookie("if_shoper",e.result.if_shoper),addcookie("talent_id",e.result.talent_id,365);var o=localStorage.getItem("thirdBack");localStorage.removeItem("thirdBack"),o.indexOf("forget_pwd_two")>0||o.indexOf("modify_password_two")>0||o.indexOf("register2")>0||o.indexOf("setting")>0||""==o||o.indexOf("bag_details")>0||o.indexOf("fenhongshop")<0?location.href=WapSiteUrl+"/wap/tmpl/member/person.html":location.href=o}}})}function a(e){var o=$("input[name='code']").val();$.ajax({type:"get",url:WapSiteUrl+"/api/index.php?act=common_member&op=check_phone",data:{mobile:e,flag:"wap"},dataType:"json",success:function(t){if("1000002"==t.error)r(e);else if("1000011"==t.error||"0"==t.error){var i=JSON.stringify(l);n(i,o,e,e)}}})}function n(e,o,t,i){$.ajax({type:"post",url:WapSiteUrl+"/api/index.php?act=common_member&op=third_register",data:{flag:"wap",type:"sina",mobile:t,code:o,pwd:i,info:e},dataType:"json",success:function(o){if(o&&0==o.error){addcookie("member_name",o.result.member_name),addcookie("mid",o.result.member_id),addcookie("token",o.result.token),addcookie("member_mobile",o.result.member_mobile),addcookie("store_id",o.result.store_id),addcookie("if_shoper",o.result.if_shoper),addcookie("talent_id",o.result.talent_id,365),localStorage.setItem("unionid",e.unionid),localStorage.setItem("info",JSON.stringify(e));var t=localStorage.getItem("thirdBack");localStorage.removeItem("thirdBack"),t.indexOf("forget_pwd_two")>0||t.indexOf("modify_password_two")>0||t.indexOf("register2")>0||t.indexOf("setting")>0||""==t||t.indexOf("bag_details")>0||t.indexOf("fenhongshop")<0?location.href=WapSiteUrl+"/wap/tmpl/member/person.html":location.href=t}}})}var d=GetQueryString("infoStr"),l=JSON.parse(d),m=GetQueryString("type");$("#img_secode").click(function(){FL.getHash("img_secode")});var s=function(){this.onLoad=function(){FL.getHash("img_secode"),o(),t()}};e.Member=e.Member||{},Member.WeiboBind=new s}(this);