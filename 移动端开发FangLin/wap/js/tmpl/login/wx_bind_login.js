!function(e){function t(e){FL.ajaxDate("get",sms_code_init,{mobile:e},function(e){if("0"===e.error){var t=e.result;if(countdown=t.countdown,if_captcha=t.if_captcha,mobile_correct=t.mobile_correct,sms_available=t.sms_available,$("#getCode").attr("countdown",countdown),t.last_countdown&&FL.countDown(t.last_countdown,$("#getCode")),"1"==if_captcha){$("#secodebox").show();var i=$("#mobile").val();$("#img_secode").attr("src",WapSiteUrl+"/api/index.php?act=common_index&op=get_captcha&flag=wap&mobile="+i),a()}else{$("#secodebox").hide();var n=$("#getCode").attr("countdown");$("#code").focus();var i=$("#mobile").val();FL.getSmsCode(i,n,"getCode"),o()}$(".cleareye").click(function(){"text"==$("#password").attr("type")?($("#password").prop("type","password"),$(".cleareye").prop("src","../../src/images/wap/login/eye.png")):($("#password").prop("type","text"),$(".cleareye").prop("src","../../src/images/wap/login/eyeclick.png"))}),$(".cleartext").click(function(){$(this).parent("div").find("input").val("").focus(),$(this).hide()})}})}function o(){$("#getCode").click(function(){var e=$("input[name='mobile']").val();if(/^[1][34578]\d{9}$/.test(e)){var t=$("#getCode").attr("countdown");$("#code").focus();var o=$("#mobile").val();FL.getSmsCode(o,t,"getCode")}}),$("#code").keyup(function(){var e=this;4==$(e).val().length?$("#nextStep").removeAttr("disabled"):$("#nextStep").attr("disabled","disabled")}),$("#nextStep").click(function(){i()})}function a(){$("#getCode").click(function(){var e=$("input[name='mobile']").val();if(/^[1][34578]\d{9}$/.test(e))if(4!=$("#secode").val().length)layer.msg("请输入正确的图形验证码");else{var t=$("#getCode").attr("countdown");$("#code").focus(),FL.getSmsCode(e,t,"getCode",$("#secode").val())}else layer.msg("请输入正确的手机号！")}),$("#code").keyup(function(){var e=this;4==$(e).val().length?$("#nextStep").removeAttr("disabled"):$("#nextStep").attr("disabled","disabled")}),$("#nextStep").click(function(){i()})}function i(){var e=$("input[name='code']").val(),t=$("input[name='mobile']").val();$.ajax({type:"post",url:WapSiteUrl+"/api/index.php?act=common_member&op=check_phone_code&test=1",data:{num:t,code:e,flag:"wap"},dataType:"json",success:function(e){"0"===e.error?r(t):layer.msg(e.msg)},error:function(e){}})}function n(e,t){var o=$("input[name='code']").val();$.ajax({type:"post",url:WapSiteUrl+"/api/index.php?act=common_member&op=third_bind&test=1",data:{info:d,type:"wx",flag:"wap",mobile:e,code:o,check:t},dataType:"json",success:function(t){if(t&&0==t.error){addcookie("member_name",t.result.member_name),addcookie("mid",t.result.member_id),addcookie("token",t.result.token),addcookie("member_mobile",t.result.member_mobile),addcookie("store_id",t.result.store_id),addcookie("if_shoper",t.result.if_shoper),addcookie("nickname",t.result.member_nickname),addcookie("talent_id",t.result.talent_id,365);var o=localStorage.getItem("thirdBack");localStorage.removeItem("thirdBack"),o.indexOf("forget_pwd_two")>0||o.indexOf("modify_password_two")>0||o.indexOf("register2")>0||o.indexOf("setting")>0||""==o||o.indexOf("bag_details")>0||o.indexOf("fenhongshop")<0?location.href=WapSiteUrl+"/wap/tmpl/member/person.html":location.href=o}else"1000015"==t.error&&(FL.addShade(),$("#noinfoDialog").show(),$("#leftbtn").click(function(){$("#noinfoDialog").hide(),FL.removeShade()}),$("#rightbtn").click(function(){$("#noinfoDialog").hide(),FL.removeShade(),n(e)}))}})}function r(e){var t=$("input[name='code']").val();$.ajax({type:"get",url:WapSiteUrl+"/api/index.php?act=common_member&op=check_phone",data:{mobile:e,flag:"wap"},dataType:"json",success:function(o){if("1000002"==o.error)n(e,1);else if("1000011"==o.error||"0"==o.error){var a=JSON.stringify(s);c(a,t,e,e)}}})}function c(e,t,o,a){$.ajax({type:"post",url:WapSiteUrl+"/api/index.php?act=common_member&op=third_register&test=1",data:{flag:"wap",type:"wx",mobile:o,code:t,pwd:a,info:e,deduct_userid:l},dataType:"json",success:function(t){if(t&&0==t.error){addcookie("member_name",t.result.member_name),addcookie("mid",t.result.member_id),addcookie("token",t.result.token),addcookie("member_mobile",t.result.member_mobile),addcookie("store_id",t.result.store_id),addcookie("if_shoper",t.result.if_shoper),addcookie("nickname",t.result.member_nickname),addcookie("talent_id",t.result.talent_id,365),localStorage.setItem("unionid",e.unionid),localStorage.setItem("info",JSON.stringify(e));var o=localStorage.getItem("thirdBack");localStorage.removeItem("thirdBack"),o.indexOf("forget_pwd_two")>0||o.indexOf("modify_password_two")>0||o.indexOf("register2")>0||o.indexOf("setting")>0||""==o||o.indexOf("bag_details")>0||o.indexOf("fenhongshop")<0?location.href=WapSiteUrl+"/wap/tmpl/member/person.html":location.href=o}}})}localStorage.setItem("onetime","2");var d=GetQueryString("infoStr"),l=GetQueryString("deduct_userid"),s=JSON.parse(d);try{var m=s.nickname}catch(p){}try{var u=s.headimgurl}catch(p){}m&&$(".nickname").text(m),u&&$(".headimgurl").attr("src",u),$("#secodebox").hide(),$("#getCode").click(function(){var e=$("input[name='mobile']").val();/^[1][34578]\d{9}$/.test(e)?2==localStorage.getItem("onetime")&&(localStorage.setItem("onetime","1"),t(e),$("#getCode").hasClass("nogetcode")&&($("#secodebox").show(),$("#img_secode").attr("src",WapSiteUrl+"/api/index.php?act=common_index&op=get_captcha&flag=wap&mobile="+account),a())):layer.msg("请输入正确的手机号！")});var f=function(){this.onLoad=function(){}};e.Member=e.Member||{},Member.WxBind=new f}(this);