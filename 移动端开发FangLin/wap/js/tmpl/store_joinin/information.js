!function($,w,d){"use strict";check_login();var token=FL.token,mid=FL.mid;$(function(){$.ajax({type:"get",url:WapSiteUrl+"/api/index.php?act=common_store_joinin&op=store_info",data:{mid:mid,token:token,flag:"wap"},dataType:"json",success:function(data){if(data.result.step>=3&&(location.href="payment.html"),"0"==data.error){var html=template.render("store_info_tpl",data.result);$("#store_info").append(html);var txt="",valtxt="",that=null,itemid="",val="",post_key="",post_val="",gc_ids="",gc_names="";$("#info-form .item").each(function(t,e){$(e).click(function(){var e="#page";switch(t){case 2:e=".pagesel";break;case 3:e=".classify";break;case 4:e=".type"}return $(".page-layout").height($(w).height()),$(e).show().animate({left:0,opacity:1}),$("html,body").animate({scrollTop:"0px"},200),that=$(this),txt=$(this).find("span").text(),valtxt=$(this).find("label").text(),$("section .info").hide(),!txt||$(this).find("span").hasClass("red")?($(".ming input").val(""),$(".ming input").attr("placeholder","请填写"+valtxt)):$(".ming input").attr("value",txt),"店铺名称"==valtxt?$("#page .red").text("*店铺名称提交申请后不可修改，请认真填写。"):"商家帐号"===valtxt&&$("#page .red").text("*此账号为日后登录并管理商家中心时使用, 注册后不可修改，请牢记。"),!1})}),$(".back").click(function(){$(".page").animate({left:"-800px",opacity:0})}),$(".success").click(function(){$("p.error").hide(300),$(".ming input").click(function(){$("p.error").hide(300)}),itemid=that.find("span").attr("id");var pattern="",error_tip="",valid=!0;switch(itemid){case"seller_name":pattern=/^[a-zA-Z0-9]{5,16}$/,error_tip="*商家账号必须为5-16位数字、字母组成",post_key=itemid;break;case"store_name":pattern=/^.{5,16}$/,error_tip="*店铺名称必须为5-16位字符组成",post_key=itemid;break;case"sg_name":pattern=".pagesel",error_tip="*请选择店铺等级",post_key="sg_id";break;case"sc_name":pattern=".classify",error_tip="*请选择店铺分类",post_key="sc_id";break;case"store_class":pattern=".type",error_tip="*请选择经营类目"}if("string"!=typeof pattern?(val=$(".ming input").val(),pattern.test(val)?post_val=val:valid=!1):".type"!==pattern?(post_val=$(pattern).find("select option:selected").val(),val=$.trim($(pattern).find("select option:selected").text()),post_val||(valid=!1)):(gc_ids="",gc_names="",val="",$(pattern).find("#itemfi,#itemse,#itemtr").each(function(t,e){var a=$(e).find("option:selected"),i=a.val(),n=a.text();gc_ids+=","+i,gc_names+=","+n,val+='<li class="scope-list">'+n+"</li>",Number(i)||(valid=!1)}),gc_ids=gc_ids.slice(1),gc_names=gc_names.slice(1),valid&&(val=val+'<li class="scope-list red"data-scope="'+gc_ids+"|"+gc_names+'")>删除</li>')),"store_class"===itemid&&$(".scope-list.red").each(function(t,e){gc_ids+"|"+gc_names===$(e).attr("data-scope")&&(swal("","不能重复选择经营类目","warning"),valid=!1)}),!valid)return $("p.error").show(300),$("p.error").text(error_tip),!1;if(!val||"请填写"+valtxt==$(".ming input").attr("value"))return $(".ming input").val("请填写"+valtxt),$(".ming input").css({color:"#ff4b4b"}),!1;var data="";return data=gc_ids?eval('({token:"'+token+'",mid:"'+mid+'",gc_ids:"'+gc_ids+'",gc_names:"'+gc_names+'",flag: "wap"})'):eval('({token:"'+token+'",mid:"'+mid+'",'+post_key+':"'+post_val+'",flag: "wap"})'),$.ajax({type:"post",url:WapSiteUrl+"/api/index.php?act=common_store_joinin&op=store_info_save",data:data,dataType:"json",success:function(t){if("0"===t.error)$(".page").hide(),"store_class"===itemid?($(val).appendTo(".typeinfo ul"),$("#"+itemid).text("")):("sg_name"===itemid&&(val=val.slice(0,8)),that.find("span").text(val).removeClass("red"));else switch(t.error){case"1001006":swal("","此账号名称已存在，换一个呗~","warning"),valid=!1;break;case"1001007":swal("","此店铺名称已存在，换一个吧~","warning"),valid=!1}valid&&$(".page").hide()}}),!1}),$.ajax({type:"get",url:WapSiteUrl+"/api/index.php?act=common_goods&op=get_goods_class",dataType:"json",data:{pid:0,area:0,flag:"wap"},success:function(t){if("0"===t.error)for(var e=t.result.length,a=0;a<e;a++)$("#itemfi").append("<option value="+t.result[a].gc_id+">"+t.result[a].gc_name+"</option>")}}),$("#type select").change(function(){var t="";switch($(this).attr("id")){case"itemfi":$("#itemse").html("<option>请选择经营类目（二）</option>"),$("#itemtr").html("<option>请选择经营类目（三）</option>"),t="#itemse";break;case"itemse":$("#itemtr").html("<option>请选择经营类目（三）</option>"),t="#itemtr"}var e=$(this).find("option:selected").attr("value");t&&$.ajax({type:"get",url:WapSiteUrl+"/api/index.php?act=common_goods&op=get_goods_class",dataType:"json",data:{pid:e,area:0,flag:"wap"},success:function(e){if("0"==e.error)for(var a=0,i=e.result.length;a<i;a++)$(t).append("<option value="+e.result[a].gc_id+">"+e.result[a].gc_name+"</option>")}})}),$(".typeinfo").delegate(".scope-list.red","click",function(){var t=$(this).attr("data-scope"),e=t.split("|"),a=e[0],i=e[1],n=$(this);swal({title:"",text:"您确定删除该经营类目吗？",type:"warning",showCancelButton:!0,cancelButtonText:"取消",confirmButtonColor:"#DD6B55",confirmButtonText:"确定",closeOnConfirm:!1},function(){$.ajax({type:"post",url:WapSiteUrl+"/api/index.php?act=common_store_joinin&op=store_class_del",data:{token:token,mid:mid,flag:"wap",gc_ids:a,gc_names:i},dataType:"json",success:function(t){"0"==t.error?(n.prev().prev().prev().remove(),n.prev().prev().remove(),n.prev().andSelf().remove(),swal("","删除成功！","success")):swal("","删除失败，请重试~","error")}})})}),$(".next").click(function(){var t=!0;return $(".item span:not(#store_class)").each(function(e,a){""!==$(a).text()&&"请完善此处信息"!==$(a).text()||($(a).text("请完善此处信息").addClass("red"),t=!1)}),0===$(".scope-list").length&&($("#store_class").text("请选择经营类目").addClass("red"),t=!1),t?void swal({title:"",text:"信息一旦确定不可修改，你确定吗？",type:"warning",showCancelButton:!0,cancelButtonText:"取消",confirmButtonColor:"#DD6B55",confirmButtonText:"确定",closeOnConfirm:!1},function(){$.ajax({type:"post",url:WapSiteUrl+"/api/index.php?act=common_store_joinin&op=store_info_submit",dataType:"json",data:{token:token,mid:mid,flag:"wap"},success:function(t){"0"==t.error&&"3"===t.result.step&&(location.href="payment.html")}})}):(swal("","您的信息不完善请继续填写","info"),!1)})}}})})}($,window,document);