!function(e){function a(){$("#add_address").validate({rules:{name:{required:!0},mobile:{required:!0,telephone:!0},area_info:"required",address:"required",cert_num:{required:!1,isIdCardNo:!0}},messages:{name:{required:"收货人姓名必须填写 "},mobile:{required:"手机号不能为空！",telephone:"请填写正确的手机号"},area_info:"请选择所在地区",address:"请填写详细信息",cert_num:{isIdCardNo:"请输入正确的身份证号"}},errorPlacement:function(e,a){var r=e.text(),i='<div class="tooltip-top" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-in">'+r+"</div></div>";$(".tooltip-top").remove(),a.before(i)}})}function r(){$("#save_address").click(function(){$("#add_address").valid()&&($("#cert_num").val()&&!$("#cert_name").val()?layer.msg("请填写身份证上的姓名"):t())}),$("#area_info").click(function(){FL.getProvinceBuy("#area_info")}),$(".right-icon").click(function(){$(".right-icon").hasClass("icon-circle-blank")?$(".right-icon").attr("class","icon-ok-sign right-icon"):$(".right-icon").attr("class","icon-circle-blank right-icon")})}function i(e){$.ajax({type:"post",url:WapSiteUrl+"/api/index.php?act=buyer_delivery&op=get_address",data:{address_id:e,mid:FL.mid,token:FL.token,flag:"wap"},dataType:"json",success:function(e){if(e&&"0"===e.error){var a=e.result;$("#name").val(a.name),$("#cert_name").val(a.cert_name),$("#cert_num").val(a.cert_num),$("#area_info").val(a.area_info),$("#address").val(a.address),$("#mobile").val(a.mob_phone),$("#area_info").attr("area_id",a.area_id),$("#area_info").attr("city_id",a.city_id),1==a.is_default?$(".right-icon").attr("class","icon-ok-sign right-icon"):$(".right-icon").attr("class","icon-circle-blank right-icon")}},error:function(e){}})}function t(){var e,a=$("#name").val(),r=$("#area_info").attr("area_id");if(r)var r=$("#area_info").attr("area_id"),i=$("#area_info").attr("city_id");else var r=$("#area_info").attr("city_id"),i=$("#area_info").attr("ss");var t,d=$("#area_info").val().replace(/>/g," "),s=$("#address").val(),c=$("#mobile").val(),l=$("#cert_name").val(),_=$("#cert_num").val();t=$(".right-icon").hasClass("icon-circle-blank")?0:1,e=o?{address_id:o,name:a,area_id:r,city_id:i,area_info:d,address:s,mobile:c,is_default:t,mid:FL.mid,token:FL.token,flag:"wap",cert_name:l,cert_num:_}:{name:a,area_id:r,city_id:i,area_info:d,address:s,mobile:c,is_default:t,mid:FL.mid,token:FL.token,flag:"wap",cert_name:l,cert_num:_},$.ajax({type:"post",url:WapSiteUrl+"/api/index.php?act=buyer_delivery&op=set_address",data:e,dataType:"json",success:function(e){e&&"0"===e.error&&(layer.msg("保存成功"),setTimeout(function(){$(":input,textarea","#add_address").not(":button, :submit, :reset, :hidden").val(""),$(".right-icon").attr("class","icon-circle-blank right-icon"),n?location.replace("address.html"):location.href="address_manage.html"},1e3))},error:function(e){}})}var n=GetQueryString("type"),o=GetQueryString("address_id"),d=document.referrer;d.indexOf("order_confirmation")>0&&sessionStorage.setItem("orderbackreferurl",d),$(".goback").click(function(){"buy"==n?location.replace("../member/address.html?address_id="+o):history.back()});var s=function(){this.onLoad=function(){o&&i(o),a(),r()}};e.Member=e.Member||{},Member.AddAddress=new s}(this);