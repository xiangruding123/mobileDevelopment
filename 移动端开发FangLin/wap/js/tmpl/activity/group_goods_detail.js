!function(t){function e(t,e,o,s,i){var a={goodsId_num:t,goods_source:e,if_cart:o,pintuan_id:s,resource_tags:i};FHMall.genOrder(JSON.stringify(a))}function o(t,e,o,s,i){var a={func:"genOrder",params:{goodsId_num:t,goods_source:e,if_cart:o,pintuan_id:s,resource_tags:i}};_bridge.send(a)}function s(){$.ajax({url:WapSiteUrl+"/api/index.php?act=buyer_pintuan&op=get_pintuan_goods_detail",type:"get",dataType:"json",data:{goods_id:u,mid:FL.mid,flag:"wap",dmid:f,pintuan_id:x,resource_tags:h},success:function(t){if("0"===t.error){console.log(t);var e=t.result;template.helper("daysBetween",m);var o=template.render("details-tpl",e);$("#details").html(o);new Swiper(".swiper-container",{autoplay:6e3,effect:"fade",fade:{crossFade:!0},pagination:".swiper-pagination"});i(e)}else"0004"==t.error&&(layer.msg("此商品不存在或者已下架，看看其他商品吧！",{time:3e3}),setTimeout(function(){location.href="../index/index.html"},4500))}})}function i(t){function s(t){if(t&&0==t.error&&0!=t.result){var e='<span class="cart-num">'+t.result+"</span>";$(".shop-icon").append(e)}}$("header h2").click(function(t){var e=$(this).index()-1;if($(this).addClass("active").siblings("h2").removeClass("active"),$(".row>section").eq($(this).index()-1).show().siblings("section").hide(),1==e){var o=$("#imageText").attr("goods_commonid");c("#details_info",o)}else 2==e&&(p(F,1,"yes"),g())}),FL.getGoodsNum({success:s}),$("#imageText").click(function(){$("header h2").eq(1).click()}),$(".estimate,.com_list").click(function(){$("header h2").eq(2).click()}),$(".goods_comments img").lazyload(),if_shoper=getcookie("if_shoper"),FL.mid&&0!=if_shoper?$(".commission_shoper").hide():$(".commission_p").hide();var i=parseFloat(t.hs_rate).toFixed(2);$(".tax_num").text(100*i+"%"),tax_tate=(parseFloat(t.goods_price)*i).toFixed(2),$(".tax_money").html(tax_tate<=50?"<del>￥"+tax_tate+"</del>":"￥"+tax_tate),$("#product_data").click(function(e){t.goods_attr?($(".product_data").show(),$("body").css("overflow","hidden")):layer.msg("暂未维护产品参数")}),$(".dataClose").click(function(){$(this).parents(".product_data").hide(),$("body").css("overflow","auto")});var m=[];$(".goods_spac li").click(function(){$(".shop-input").val(1),$(".sk-tips").text(""),$(this).addClass("active").siblings("li").removeClass("active");var e=$(this).attr("spac_re"),o=$(this).parent(".goods_spac").index()/2-1;m[o]=e,$(this).parent(".goods_spac").siblings(".goods_spac").each(function(){var t=$(this).index()/2-1,e=$(this).find("li.active").attr("spac_re");m[t]=e}),m.sort(function(t,e){return t>e?1:-1}),_=t.spec_relation[m.join("|")],a(_),r(t,_)}),$(".btn_true").click(function(t){if(y=$(".shop-input").val(),"null"!=FL.store_id)var e={token:k,goods_id:_||u,quantity:y,store_id:FL.store_id,mid:v,flag:"wap",gc_area:goods_source,resource_tags:h};else var e={token:k,goods_id:_||u,quantity:y,mid:v,flag:"wap",gc_area:goods_source,resource_tags:h};d(e)}),$(".button-highlight").click(function(){var t=1;if("null"!=FL.store_id)var e={token:k,goods_id:u,quantity:t,store_id:FL.store_id,mid:v,flag:"wap",gc_area:goods_source};else var e={token:k,goods_id:u,quantity:t,mid:v,flag:"wap",gc_area:goods_source};d(e)}),$(".buy .buynow").click(function(){$("#mask").show(),FL.addShade(),$(".nowhide").hide(),$("#confirm").removeClass("none")}),r(t,_),$(".tax_click").click(function(){$(".tax_rate").show(),$(".tax_rate").addClass("animated slideInUp"),FL.addShade()}),$(".tax_close").click(function(){FL.removeShade(),FL.closeDiv(".tax_rate","hide"),$(".tax_rate").hide()}),$("#standard").click(function(){$("#mask").show(),$("#mask").addClass("animated slideInUp"),FL.addShade(),$(".nowhide").show(),$("#confirm").addClass("none"),$("body").css("overflow","hidden")}),$(".de_close").click(function(){FL.removeShade(),FL.closeDiv("#mask","hide"),$("#mask").hide(),$("body").css("overflow","auto");try{$("#confirm").removeClass("buytrue buyTrue")}catch(t){}});var f=!0;1===t.if_fav&&($("#goods_collect i").addClass("icon-heart").removeClass("icon-heart-empty"),f=!1),$("#goods_collect").click(function(t){FL.token?f?n():l():location.href="../login/login.html?goods_id="+u});var y,b;$("#goods_storage").text(parseInt($("#goods_storage").text())),$(".sub").click(function(e){y=parseInt($(".shop-input").val())-1;var o=$(".sk-limit").attr("price"),s=$(".sk-limit").attr("top_limit"),i=($(".sk-limit").attr("origin_price"),$(".sk-limit").attr("killing_stock"));return s&&parseInt(y)<=parseInt(i)&&(parseInt(y)<=parseInt(s)||0==s)&&($("#goods_storage").text(i),$(".fh-price").text("￥"+o),$("#mask-sk").show(),$(".sk-tips").text("")),y<=0?(layer.msg("选择不能小于1件"),!1):($(".shop-input").val(y+""),void(t.xianshi&&y<t.xianshi.lower_limit&&$(".popbox .fh-price").text(t.goods_price)))}),$(".shop-input").keyup(function(){($(this).val()<=1||isNaN($(this).val()))&&$(this).val(1);var t=$(this).val(),e=$(".sk-limit").attr("price"),o=$(".sk-limit").attr("top_limit"),s=$(".sk-limit").attr("origin_price"),i=$(".sk-limit").attr("killing_stock");b=parseInt($("#goods_storage").text());var a=$("#goods_storage").attr("all_storage");o&&(parseInt(t)<=parseInt(i)?parseInt(t)>parseInt(o)&&0!=o?($(".fh-price").text("￥"+s),$("#goods_storage").text(a),$("#mask-sk").hide(),$(".sk-tips").text("超出限购数量不享受优惠价")):($(".fh-price").text("￥"+e),$("#goods_storage").text(i),$("#mask-sk").show(),$(".sk-tips").text("")):parseInt(t)>parseInt(i)&&($(".fh-price").text("￥"+s),$("#goods_storage").text(a),$("#mask-sk").hide(),parseInt(i)<parseInt(o)||0==o?$(".sk-tips").text("大于秒杀库存不享受优惠价"):$(".sk-tips").text("超出限购数量不享受优惠价"))),$(this).val()-$("#goods_storage").text()>0&&(layer.msg("库存不足"),$(this).val(parseInt($("#goods_storage").text())))}),$(".add").click(function(e){y=parseInt($(".shop-input").val())+1,b=parseInt($("#goods_storage").text());var o=($(".sk-limit").attr("price"),$(".sk-limit").attr("top_limit")),s=$(".sk-limit").attr("origin_price"),i=$(".sk-limit").attr("killing_stock"),a=$("#goods_storage").attr("all_storage");return b-y<0&&y>a?(layer.msg("库存不足"),!1):($(".shop-input").val(y+""),o&&(parseInt(y)<=parseInt(i)?y>o&&0!=o&&($(".fh-price").text("￥"+s),$("#goods_storage").text(a),$("#mask-sk").hide(),$(".sk-tips").text("超出限购数量不享受优惠价")):parseInt(y)>parseInt(i)?($(".fh-price").text("￥"+s),$("#goods_storage").text(a),$("#mask-sk").hide(),parseInt(i)<parseInt(o)&&$(".sk-tips").text("大于秒杀库存不享受优惠价")):$(".sk-tips").text("")),void(t.xianshi&&y>=t.xianshi.lower_limit&&$(".popbox .fh-price").text(t.xianshi.price)))}),$(".goappbuy").click(function(){location.href=WapSiteUrl+"/wap/tmpl/shopping/goods_details.html?goods_id="+u+"!goodsdetail"}),$(".goappdata").click(function(){var s=u+"|1",i=0,a=t.goods_source;"0"==native_flag?e(s,a,i,x,h):"1"==native_flag?connectWebViewJavascriptBridge(function(t){_bridge=t;try{t.init(function(t,e){})}catch(e){}o(s,a,i,x,h)}):location.href=WapSiteUrl+"/wap/tmpl/order/order_confirmation.html?if_cart="+i+"&area="+a+"&cart_info="+s+"&pintuan_id="+x+"&miaosha=&resource_tags="+h})}function a(t){$.ajax({url:WapSiteUrl+"/api/index.php?act=common_goods&op=goods_spec_select",type:"get",dataType:"json",data:{goods_id:t,flag:"wap",mid:FL.mid},success:function(t){if("0"===t.error){var e=t.result;if($("#spac_img").prop("src",e.goods_image+"!small"),$("#goods_storage").text(e.goods_storage),e.xianshi?$(".popbox>div>.fh-price").text("￥"+e.xianshi.price):$(".popbox>div>.fh-price").text("￥"+e.goods_price),e.seckilling&&e.seckilling.top_limit!=e.seckilling.purchased_num||e.seckilling&&0==e.seckilling.top_limit){var o=e.seckilling.killing_stock;$("#goods_storage").text(o);var s=e.seckilling.origin_price,i=e.seckilling.price,a=e.seckilling.top_limit,r=$(".shop-input").val();$("#mask-sk").remove();var n='<div class="seckill mt5" id="mask-sk" ><img src="../../images/wap/app_miaosha.png" class="app-seckill"><span class="sk-limit" price="'+i+'" top_limit="'+a+'" origin_price="'+s+'" killing_stock="'+o+'">限购'+a+"件</span></div>";$("#mask_div").append(n),r<=a?($("#mask-sk").show(),$(".popbox>div>.fh-price").text("￥"+i)):($("#mask-sk").hide(),$(".popbox>div>.fh-price").text("￥"+s))}else $("#mask-sk").remove()}}})}function r(t,e){var o="../order/order_confirmation.html?if_cart=0&area="+t.goods_source;if(e)var s=e;else var s=u;var i=$(".sk-limit");$(".buy .nowbuy,#confirm").click(function(e){if(FL.token){var a=$(".shop-input").val(),r=$("#goods_storage").text();0==t.sale_stop?r<a?layer.msg("库存不足"):(addcookie("cartGoodsNum",a),0!=i.length&&i.parent().is(":visible")?location.href=o+"&cart_info="+s+"|"+a+"&miaosha="+u+"&resource_tags="+h:location.href=o+"&cart_info="+s+"|"+a+"&miaosha=&resource_tags="+h):1==t.sale_stop&&layer.msg("商品即将发售，敬请期待！")}else location.href="../login/login.html?goods_id="+u+"&resource_tags="+h})}function n(){$.ajax({url:WapSiteUrl+"/api/index.php?act=buyer_favorite&op=add_favorites",type:"post",dataType:"json",data:{token:k,fid:u,mid:v,type:"goods",flag:"wap"},success:function(t){"0"===t.error?($("#goods_collect i").addClass("icon-heart").removeClass("icon-heart-empty"),layer.msg("收藏商品成功")):"0008"===t.error?location.href="../login/login.html?goods_id="+u:layer.msg(t.msg),flag=!1},error:function(){layer.msg("收藏商品失败"),flag=!0}})}function l(){$.ajax({url:WapSiteUrl+"/api/index.php?act=buyer_favorite&op=delete_favorites",type:"post",dataType:"json",data:{token:k,fid:u,mid:v,type:"goods",flag:"wap"},success:function(t){"0"===t.error?($("#goods_collect i").addClass("icon-heart-empty").removeClass("icon-heart"),layer.msg("已取消收藏")):"0008"===t.error?location.href="../login/login.html?goods_id="+u:layer.msg(t.msg),flag=!0},error:function(){layer.msg("取消收藏失败"),flag=!1}})}function d(t){$("#goods-details #addOne").hide(),$.ajax({url:WapSiteUrl+"/api/index.php?act=buyer_cart&op=add",type:"get",dataType:"json",data:t,success:function(t){function e(t){if(t&&0==t.error){var e='<span class="cart-num">'+t.result||"0</span>";$("#shop").append(e)}}"0"===t.error?(FL.closeDiv("#mask","hide"),layer.msg("添加购物车成功"),$("#mask").hide(),$(".loading-shade").hide(),$("#goods-details #addOne").show(),FL.getGoodsNum({success:e})):"0008"===t.error?location.href="../login/login.html?goods_id="+u:"2001008"===t.error&&(FL.closeDiv("#mask","hide"),$("#mask").hide(),$(".loading-shade").hide())},error:function(t){}})}function c(t,e){$.ajax({url:WapSiteUrl+"/api/index.php?act=common_goods&op=get_goods_graphic",type:"get",dataType:"json",data:{goods_commonid:e,flag:"wap"},success:function(e){if("0"===e.error){if("string"==typeof e.result.pc_body)$(t).html(e.result.pc_body);else{$(t).empty();for(var o=0;o<e.result.pc_body.length;o++)"image"==e.result.pc_body[o].type?$(t).append('<img src="'+e.result.pc_body[o].value+'" >'):$(t).append("<p>"+e.result.pc_body[o].value+"</p>")}e.result.goods_source>0&&$(t).prepend('<img src="../../images/wap/goodsgraphic.png" alt="image">'),$.scrollTo(t,"100%")}}})}function p(t,e,o){$.ajax({url:WapSiteUrl+"/api/index.php?act=common_goods&op=get_goods_comments",type:"get",dataType:"json",data:{goods_id:u,num:b,curpage:e,flag:"wap",type:t},success:function(e){if(e&&"0"===e.error){if(template.helper("daysBetween",m),"yes"==o){var s=template.render("details_comment_title_tpl",e.result);$("#details_comment .details_comment-title").empty(),$("#details_comment .details_comment-title").html(s)}$(".details_comment_btn>button").eq(t).addClass("selected").siblings("button").removeClass("selected"),""==e.result.comments&&$(".details_comment_btn>button").removeClass("selected"),$("#details_comment .focus-color").text(e.result.good_percent+"%"),$("#details_comment .span-right").text(e.result.all_count+"人评价");var s=template.render("details_comment_tpl",e.result);"no"==o?$("#details_comment .goods-assess>ul").append(s):($("#details_comment .goods-assess>ul").empty(),$("#details_comment .goods-assess>ul").html(s)),$("#details_comment img").lazyload(),$(".details_comment_btn>button").click(function(e){t=$(this).index(),console.log(t),p(t,1,"yes"),$(this).addClass("selected").siblings("button").removeClass("selected")})}}})}function g(){$(window).scroll(function(){var t=document.body.scrollHeight||document.documentElement.scrollHeight,e=document.body.clientHeight||document.documentElement.clientHeight,o=document.body.scrollTop||document.documentElement.scrollTop;if(o+e==t){var s=$("#details_comment .goods-assess>ul>li").length;if(y=s/10+1,I==y||!w.test(y))return!1;F=$(".details_comment_btn .selected").index(),F<0&&(F=0),p(F,y,"no"),I=y}})}function m(t,e){var o=t.substring(5,t.lastIndexOf("-")),s=t.substring(t.length,t.lastIndexOf("-")+1),i=t.substring(0,t.indexOf("-")),a=e.substring(5,e.lastIndexOf("-")),r=e.substring(e.length,e.lastIndexOf("-")+1),n=e.substring(0,e.indexOf("-")),l=(Date.parse(o+"/"+s+"/"+i)-Date.parse(a+"/"+r+"/"+n))/864e5;return Math.abs(l)}var _,u=GetQueryString("goods_id"),h=GetQueryString("resource_tags"),f=GetQueryString("dmid"),k=getcookie("token"),v=getcookie("mid"),x=GetQueryString("pintuan_id"),y=1,b=10,w=/^[-]{0,1}[0-9]{1,}$/,I=0,F=0;FL.addLibrary(u);var L=function(){this.onLoad=function(){s()}};t.Goods=t.Goods||{},Goods.goodsDetail=new L}(this);