$(function(){function e(e){window.WebViewJavascriptBridge?e(WebViewJavascriptBridge):document.addEventListener("WebViewJavascriptBridgeReady",function(){e(WebViewJavascriptBridge)},!1)}function t(t){$.ajax({type:"get",url:WapSiteUrl+"/api/index.php?act=buyer_activity&op=get_activity_detail",data:{activity_id:t,type:"hongbao",flag:"wap"},dataType:"json",success:function(t){if(t&&0==t.error){$("title,.header-title").text(t.result.activity_title),$(".banner").attr("src",t.result.activity_banner),template.helper("parseFloat",parseFloat);var i=template.render("floor_tpl",t);$("#floor").html(i);var i=template.render("activity_slides_tpl",t);$("#activity_slides").html(i),$("#activity_slides img").lazyload(),$("#floor img").lazyload(),o(t.result.coupon_batchs[0]);var n=t.result.share_title,l=t.result.share_desc,c=t.result.share_img,s=window.location.href;r(n,l,c,s),FL.wxShare(n,l,s,c),$("#floor li").click(function(){var t=$(this).attr("data-id");if("0"==native_flag)FHMall.gotoActivity("com.fanglin.fenhong.microbuyer.buyer.GoodsDetailsActivity",t);else if("1"==native_flag){var t=$(this).attr("data-id");e(function(e){u=e;try{e.init(function(e,t){})}catch(i){}a(t)})}else"-1"==native_flag&&(location.href="../shopping/goods_details.html?goods_id="+t)});var d=parseInt($("#floor li").width());$("#floor img").css({width:d+"px",height:d+"px"})}},error:function(e){}})}function i(e,t){$.ajax({type:"get",url:WapSiteUrl+"/api/index.php?act=buyer_coupon&op=get_bag_detail",data:{mid:e,batch_id:t,flag:"wap"},dataType:"json",success:function(e){e&&"0"===e.error&&("1"==e.result.is_gotten?($(".checked").removeClass("none"),$(".oldy").addClass("none")):($(".oldy").removeClass("none"),$(".checked").addClass("none")))}})}function a(e){var t={func:"togoodsdtl",params:{goods_id:e}};u.send(t)}function n(){var e={func:"logoff",params:""};u.send(e)}function o(t){function a(e){var a={func:"getmember",params:""};u.send(a,function(a){a?(i(a.member_id,t),"iosyes"==e&&s(a.member_id,a.token,t)):"iosyes"==e&&n()})}if("0"==native_flag){var o=getMemberInfo();o&&i(o.member_id,t),$(".oldy").click(function(){var e=getMemberInfo();e?(i(e.member_id,t),s(e.member_id,e.token,t)):FHMall.logOff()})}else"1"==native_flag?(e(function(e){u=e;try{e.init(function(e,t){})}catch(t){}a()}),$(".oldy").click(function(){a("iosyes")})):"-1"==native_flag&&(0==FL.isWeiXin()&&$(".fh-header").removeClass("none"),FL.mid?(i(FL.mid,t),$(".oldy").click(function(){s(FL.mid,FL.token,t)})):$(".oldy").click(function(){FL.logLogin()}))}function r(t,i,a,n){var o=navigator.userAgent.toLowerCase();o.indexOf("fhmall_android")>0?l(t,i,a,n):o.indexOf("fhmall_ios")>0&&e(function(e){u=e;try{e.init(function(e,t){})}catch(o){}c(t,i,a,n)})}function l(e,t,i,a){var n={title:e,content:t,imgs:i,url:a};FHMall.enableShareButton(JSON.stringify(n))}function c(e,t,i,a){var n={func:"enableshare",params:{title:e,content:t,imgs:i,url:a}};u.send(n)}function s(e,t,i){$.ajax({type:"post",url:WapSiteUrl+"/api/index.php?act=buyer_coupon&op=get_bag",data:{mid:e,token:t,batch_id:i,flag:"wap"},timeout:3e3,dataType:"json",success:function(i){"0"==i.error&&d(e,t,i.result)},error:function(e){layer.msg("服务器繁忙，请稍候领取")},complete:function(e,t){"timeout"==t&&layer.msg("正在拼命加载，请稍候领取")}})}function d(e,t,i){$.ajax({type:"post",url:WapSiteUrl+"/api/index.php?act=buyer_coupon&op=get_coupon",data:{mid:e,token:t,bag_id:i,flag:"wap"},dataType:"json",timeout:3e3,success:function(e){"0"==e.error&&("success"==e.result?(layer.msg("你已经成功领取红包"),$(".checked").removeClass("none"),$(".oldy").addClass("none")):"pending"==e.result&&(layer.msg("手机号还未注册，快去下载app吧"),location.href="http://a.app.qq.com/o/simple.jsp?pkgname=com.fanglin.fenhong.microbuyer"))},error:function(){layer.msg("服务器繁忙中，请稍候领取")},complete:function(e,t){"timeout"==t&&layer.msg("正在拼命加载中，请稍候领取")}})}var u,f=GetQueryString("activity_id");ImgFormat(),t(f)});