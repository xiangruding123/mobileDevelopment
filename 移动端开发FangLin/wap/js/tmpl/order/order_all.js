$(function(){function e(){$("#order_state li").eq(r).addClass("selected").siblings("li").removeClass("selected"),$(".tableChange").eq($(".selected").index()).show().siblings(".tableChange").hide(),l=$(".selected").attr("order_state"),tpl=$(".selected").attr("tpl"),section_id=$(".tableChange").eq($(".selected").index()),o(l,c,1,tpl,section_id,!0)}function t(){$("#order_state li").click(function(){$(this).addClass("selected").siblings("li").removeClass("selected"),$(".tableChange").eq($(this).index()).show().siblings(".tableChange").hide(),l=$(".selected").attr("order_state"),tpl=$(".selected").attr("tpl"),section_id=$(".tableChange").eq($(".selected").index()),$(".ord_empty").hide(),o(l,c,1,tpl,section_id,!0)})}function i(){n(),$(".unweixin").click(function(){FL.isWeiXin()&&0!=$(this).attr("country_source")?(pay_sn=$(this).attr("pay_sn"),pay_amount=$(this).attr("real_amount"),location.href="order_pay.html?pay_sn="+pay_sn+"&pay_amount="+pay_amount+"&payment=zfb"):(pay_sn=$(this).attr("pay_sn"),pay_amount=$(this).attr("real_amount"),location.href="order_pay.html?pay_sn="+pay_sn+"&pay_amount="+pay_amount)}),$("button.cancelorder").click(function(){$("#mask").show(),$("#maskbox").show(),order_id=$(this).attr("order_id"),that=$(this).parents("div.media");var e=($(window).width()-$("#maskbox").width())/2,t=($(window).height()-$("#maskbox").height())/2;$("#maskbox").css({left:e+"px",top:t+"px"})}),$("#mask").click(function(){$("#mask").hide(),$("#maskbox").hide()}),$("#maskbox p").click(function(){msg=$(this).text(),s(order_id,msg,that)}),$(".delorder").click(function(){order_id=$(this).attr("order_id"),thatParent=$(this).parents("div.media"),d(order_id,thatParent)}),$(".receipt").click(function(){var e=$(this).attr("order_id");FL.addShade(),$("#goods_receipt_dialog").show(),$("#goods_receipt_dialog #rightbtn").click(function(){a(e,parent)}),$("#goods_receipt_dialog #leftbtn").click(function(){$("#goods_receipt_dialog").hide(),FL.removeShade()})}),$("#goods_receipt_dialog_success #leftbtn").click(function(){$("#goods_receipt_dialog_success").hide(),FL.removeShade()}),$("#goods_receipt_dialog_success #leftbtn").click(function(){location.href="order_all.html?index=4",$("#goods_receipt_dialog_success").hide(),FL.removeShade()})}function o(e,t,o,a,s,d){$.ajax({url:WapSiteUrl+"/api/index.php?act=buyer_order&op=get_order_list",type:"post",dataType:"json",data:{flag:"wap",token:FL.token,mid:FL.mid,state:e,num:t,curpage:o},success:function(t){if("0"===t.error){if(console.log(t),d){var o=template.render(a,t);s.empty(),s.html(o)}else{var o=template.render(a,t);s.append(o)}$(".ord_empty").hide(),i(),$(".tableChange").eq($(".selected").index()).find(".media").each(function(e){var t=this,i=$(window).width(),o=$(t).find(".container .pull-left img").length,a=60*o+50;if(a>i)if($(t).find(".container .pull-left").css("width",a+"px"),$(t).find(".container>div").attr("class")=="imglist_"+e){new IScroll(".imglist_"+e,{scrollX:!0,scrollY:!1,mouseWheel:!0})}else if($(t).find(".container>div").attr("class")=="imglist_1_"+e){new IScroll(".imglist_1_"+e,{scrollX:!0,scrollY:!1,mouseWheel:!0})}else if($(t).find(".container>div").attr("class")=="imglist_2_"+e){new IScroll(".imglist_2_"+e,{scrollX:!0,scrollY:!1,mouseWheel:!0})}else if($(t).find(".container>div").attr("class")=="imglist_3_"+e){new IScroll(".imglist_3_"+e,{scrollX:!0,scrollY:!1,mouseWheel:!0})}else if($(t).find(".container>div").attr("class")=="imglist_4_"+e){new IScroll(".imglist_4_"+e,{scrollX:!0,scrollY:!1,mouseWheel:!0})}})}else d&&(s.empty(),$(".ord_empty").show(),"0"==e?$(".ord_empty p").text("没有待付款的订单！"):"10"==e?$(".ord_empty p").text("没有待付款的订单！"):"20"==e?$(".ord_empty p").text("没有待发货的订单！"):"30"==e?$(".ord_empty p").text("没有待收货的订单！"):"100"==e&&$(".ord_empty p").text("没有待评价的订单！"))}})}function a(e,t){$.ajax({url:WapSiteUrl+"/api/index.php?act=buyer_order&op=receive_order",type:"post",dataType:"json",data:{flag:"wap",token:FL.token,mid:FL.mid,order_id:e},success:function(e){"0"===e.error&&($("#goods_receipt_dialog").hide(),$("#goods_receipt_dialog_success").show(),t.hide())}})}function s(e,t,i){$.ajax({url:WapSiteUrl+"/api/index.php?act=buyer_order&op=cancle_order",type:"post",dataType:"json",data:{flag:"wap",token:FL.token,mid:FL.mid,msg:t,order_id:e},success:function(e){"0"===e.error&&($("#mask").hide(),$("#maskbox").hide(),i.hide(),layer.msg("取消成功"))}})}function d(e,t){$.ajax({url:WapSiteUrl+"/api/index.php?act=buyer_order&op=delete_order",type:"post",dataType:"json",data:{flag:"wap",token:FL.token,mid:FL.mid,order_id:e},success:function(e){"0"===e.error&&($("#mask").hide(),$("#maskbox").hide(),t.hide(),t.next(".empty").hide(),layer.msg("删除成功"))}})}function n(){$(window).scroll(function(){var e=document.body.scrollHeight||document.documentElement.scrollHeight,t=document.body.clientHeight||document.documentElement.clientHeight,i=document.body.scrollTop||document.documentElement.scrollTop;if(i+t>=e){var a=$(".tableChange").eq($(".selected").index()).find(".media").length;p=a/7+1,m!=p&&_.test(p)&&(o(l,c,p,tpl,section_id,!1),m=p)}})}FL.judgeLogin();var l,r=GetQueryString("index"),c=7,p=1;FL.fhload();var _=/^[-]{0,1}[0-9]{1,}$/,m=0;e(),t()});