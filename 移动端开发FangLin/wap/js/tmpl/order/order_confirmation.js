!function(t){function e(){_=GetQueryString("cart_info"),p=GetQueryString("if_cart"),f=GetQueryString("area"),w=""+GetQueryString("miaosha");var t=GetQueryString("address_id");t||(addcookie("cart_info",_),addcookie("if_cart",p),addcookie("area",f)),a(t)}function a(t){_=unescape(getcookie("cart_info")),p=getcookie("if_cart"),f=getcookie("area");var e=getcookie("member_store_id");if(e&&t)var a={mid:FL.mid,flag:"wap",token:FL.token,cart_info:_,if_cart:p,member_store_id:e,address_id:t,area:f};else if(e&&!t)var a={mid:FL.mid,flag:"wap",token:FL.token,cart_info:_,if_cart:p,member_store_id:e,area:f};else if(!e&&t)var a={mid:FL.mid,flag:"wap",token:FL.token,cart_info:_,if_cart:p,address_id:t,area:f};else var a={mid:FL.mid,flag:"wap",token:FL.token,cart_info:_,if_cart:p,area:f};$.ajax({type:"post",url:WapSiteUrl+"/api/index.php?act=buyer_cart&op=check_cart",data:a,dataType:"json",success:function(t){if(t&&"0"==t.error){g=t.result.vat_hash,h=t.result.offpay_hash,m=t.result.offpay_hash_batch,L=t.result.custom_index,S=t.result.custom_claim,addcookie("area",f),addcookie("custom_index",L);var e=template.render("my_address",t.result);if($("#myAddress").empty(),$("#myAddress").html(e),t.result.address&&(v=t.result.address.cert_num),t.result.store_cart_list){template.helper("floatPrice",u);var a=template.render("goods_details",t.result);$("#goods-list").empty(),$("#goods-list").html(a),f&&0!=f&&c(t.result.store_cart_list[0].goods_list)}else history.go(-1);t.result.not_deliver_areas_goods_list&&t.result.not_deliver_areas_goods_list.length>0&&(FL.addShade(),$("#noinfoDialog").show(),$("#leftbtn").click(function(){location.href="../member/address.html?address_id="+t.result.address.address_id}),$("#rightbtn").click(function(){"0"==f?location.href="../shopping/shopping_cart_cn.html":location.href="../shopping/shopping_cart_global.html"}));var r=$(".seckill-goods");if(r.length>0)for(var n=0;n<r.length;n++){var d=$(r[n]).attr("top_limit"),_=$(r[n]).attr("goods_num"),p=$(r[n]).attr("old_price");_>d&&$(r[n]).text("￥"+p)}$(".bl-ul").click(l);var y=FL.functional_control(),k=y.type,b=y.name;if("hongbao"==b&&("all"==k||k.indexOf("wap")>-1)){$("#tickets").show();var x=y.message,F=y.url;$("#ticket_num").attr("class","noticket"),$("#ticket_num").text(x),F&&$("#tickets").click(function(){location.href=F})}else{if(t.result.coupon_list&&t.result.coupon_list.available){var w=0;for(var n in t.result.coupon_list.available)w+=1;if(0!=w){$("#ticket_num").text(w+"张优惠券可用"),i(),$("#tickets").show(),$("#tickets_cancel").show(),$("#use").text(w);var G=document.documentElement.clientHeight,C=G-93;$("#ticket").css("height",G+"px"),$("#bag_lists,#un_bag_lists").css({height:C+"px",overflow:"scroll"});var Q=$(document).width();if(Q>640){var j=(Q-640)/2;$("#ticket").css("left",j+"px")}template.helper("format",FL.dateFormat);var M=template.render("bagLists",t.result.coupon_list);$("#bag_lists").empty(),$("#bag_lists").html(M),o()}}if(t.result.coupon_list&&t.result.coupon_list.unavailable){var N=0;for(var n in t.result.coupon_list.unavailable)N+=1;$("#unuse").text(N),template.helper("format",FL.dateFormat);var A=template.render("unBagLists",t.result.coupon_list);$("#un_bag_lists").empty(),$("#un_bag_lists").html(A),$("#un_bag_lists").append("<div style='height:30px;width:100%;background:#f0f0f0'></div>")}}s()}},error:function(t){}})}function i(){$("#tickets").click(function(){$("#ticket").show()}),$("#hideBag").click(function(){$("#ticket").hide()}),$(".bag-nav li").click(function(){var t=this,e=$(t).attr("tabId");0==e?($("#un_bag_lists").hide(),$("#bag_lists").show()):($("#bag_lists").hide(),$("#un_bag_lists").show()),$(t).addClass("selected").siblings("li").removeClass("selected")})}function o(){$(".single-bag").click(function(){var t=this;b=$(t).attr("coupon_id"),G=$(t).attr("coupon_price"),$("#ticket_num").text("已选中一张￥"+parseFloat(G).toFixed(2)+"的优惠券"),$(".bag-i").attr("class","icon-circle-blank bag-i"),$(t).find("i").attr("class","icon-ok-sign bag-i"),$("#cancelMoney").text("-￥"+parseFloat(G).toFixed(2)),setTimeout(function(){$("#ticket").hide()},200),isNaN(x)||(F=(x-G).toFixed(2),F<=0?F="0.00":F,$("#total_price").text("￥"+F))})}function s(){var t=$("#goods-list").find(".store_goods"),e=0,a=parseFloat("0.00");parseFloat("0.00");freightPrice=parseFloat("0.00");for(var i=0;i<t.length;i++){for(var o=$(t[i]).find(".container"),s=$(t[i]).find(".prompt").attr("free_freight_list"),r=0,n=parseFloat("0.00"),c=parseFloat("0.00"),l=parseFloat("0.00"),d=parseFloat($(t[i]).find(".express_price").text().slice(1)),u=0;u<o.length;u++){var _=$(o[u]).find(".goods-price").text().slice(1),p=$(o[u]).find(".module-num").text().slice(1);o.attr("hs_rate");if(0!=$(o[u]).find(".bl-ul li").length){var g=$(o[u]).find(".bl-ul li").length*p;r+=g}else r+=parseInt(p);c+=parseFloat(_*p)}l=parseFloat($(t[i]).attr("dutyPrice")),f&&0!=f&&($("#duty").show(),$("#dutyMoney").removeClass("crossed"),$(t[i]).find("#dutyMoney").text("￥"+l),$(".free-duty").show());var h=$(t[i]).find("#youhui .fh-black").text().slice(2);n=(c+l+d-h).toFixed(2),a+=parseFloat(n),e+=r,$(t[i]).find(".real_price").text("￥"+c.toFixed(2)),c<s&&$(".prompt").hide()}var m=getcookie("cartGoodsNum");$("#total_num").html("共 "+m+" 件"),isNaN(a)?$("#total_price").html(""):$("#total_price").html("￥"+a.toFixed(2)),x=a}function r(){var t,e=$(".adr-body").attr("address_id");t=b?{mid:FL.mid,flag:"wap",token:FL.token,seckilling_goods:w,cart_info:_,if_cart:p,area:f,address_id:e,vat_hash:g,offpay_hash:h,offpay_hash_batch:m,coupon_id:b,pintuan_id:Q,pintuan_group_id:j,pintuan_parent_id:M,resource_tags:C}:{mid:FL.mid,flag:"wap",token:FL.token,seckilling_goods:w,cart_info:_,if_cart:p,area:f,address_id:e,vat_hash:g,offpay_hash:h,offpay_hash_batch:m,pintuan_id:Q,pintuan_group_id:j,pintuan_parent_id:M,resource_tags:C},$.ajax({type:"post",url:WapSiteUrl+"/api/index.php?act=buyer_order&op=submit",data:t,dataType:"json",success:function(t){t&&0==t.error?(y=t.result.pay_sn,k=t.result.pay_amount,0==k?location.href="order_success.html?pay_sn="+y+"&pay_amount="+k+"&type=coupon":location.href="order_pay.html?pay_sn="+y+"&pay_amount="+k):layer.msg(t.msg)}})}function n(){$(".pay-chose").click(function(){var t=this;$(".pay-chose").attr("class","icon-circle-blank pay-chose"),$(t).attr("class","icon-ok-sign pay-chose")}),$("#pay_money").click(function(){if($("#agree_select").attr("class").indexOf("icon-ok-circle")>=0){var t=$(".adr-body").attr("address_id"),e=navigator.userAgent.toLowerCase();"micromessenger"==e.match(/MicroMessenger/i)&&1==f&&1==L||(0==f?t?r():layer.msg("请添加收货地址"):0!=f&&(t?""==v&&1==S?(layer.msg("购买国外商品收货地址要填写身份证信息",{time:4e3}),$("#myAddress").css("border","2px solid #fa2855")):r():layer.msg("请添加收货地址")))}}),$("#no_wxpay").click(function(){$("#no_wxpay").hide()}),$("#agree_select").click(function(){var t=this;$(t).attr("class").indexOf("icon-ok-circle")>=0?($(t).removeClass("icon-ok-circle").addClass("icon-circle-blank"),$("#pay_money").css("background-color","#666")):($(t).removeClass("icon-circle-blank").addClass("icon-ok-circle"),$("#pay_money").css("background-color","#fa2855"))})}function c(t){for(var e=0;e<t.length;e++);$("#duty").show()}function l(){var t=this,e=$(t).attr("goods_id"),a=$(t).attr("bl_id");d(e,a);var i=document.body.clientHeight-48;$("#suit").css("height",document.body.clientHeight+50+"px"),$("#suit_list").css({height:i+"px",overflow:"scroll"});var o=document.body.clientWidth;if(o>640){var s=(o-640)/2;$("#suit").css("left",s+"px")}$("#suit").show(),$("body").css("overflow","hidden")}function d(t,e){$.ajax({type:"get",url:WapSiteUrl+"/api/index.php?act=common_goods&op=get_bundling_combo",data:{goods_id:t,flag:"wap"},dataType:"json",success:function(t){if(t&&0==t.error){for(var a,i,o=0;o<t.result.bundling.length;o++)t.result.bundling[o].bl_id==e&&(a=t.result.bundling[o],i=a.cost_price-a.current_price);var s=template.render("suitList",a);$("#suit_list").html(s),$("#save_price").text("立省"+i.toFixed(2)+"元")}else layer.msg(t.msg)}})}function u(t){return parseFloat(t).toFixed(2)}var _,p,f,g,h,m,y,k,v,b,x,F,w,L,S,G=0,C=GetQueryString("resource_tags"),Q=GetQueryString("pintuan_id"),j=GetQueryString("pintuan_group_id"),M=GetQueryString("pintuan_parent_id");$("#hideSuit").click(function(){$("#suit").hide(),$("body").css("overflow","auto")});var N=function(){this.onLoad=function(){FL.judgeLogin(),e(),n()}};t.Goods=t.Goods||{},Goods.Confirmation=new N}(this);