!function(t){function e(t){$.ajax({type:"get",url:WapSiteUrl+"/api/index.php?act=buyer_cart&op=list",data:{mid:FL.mid,type:"db",flag:"wap",gc_area:1,token:FL.token},dataType:"json",success:function(t){if(t&&"0"==t.error){var e=template.render("goods_cn",t);$("#cart_cn").empty(),$("#cart_cn").html(e),U(),0!=$(".store_goods").length&&$("#edit").show(),w(),t.result.mansong&&addcookie("manzeng",JSON.stringify(t.result.mansong)),t.result.manselect_info&&sessionStorage.setItem("manselect_info",JSON.stringify(t.result.manselect_info)),$(".sub").click(h),$(".add").click(u),$(".num").keyup(v),$("#shopping").on("click",".single",n),$(".all").click(a),$(".store").click(i),$(".close").click(function(){var t=this;W(function(){g(t)})}),I(),k(),y(),$(".post").click(N),$(".send").click(T);for(var r=0;r<$(".store_goods").length;r++)_($(".all").eq(r))}},error:function(t){}})}function n(){var t=this;r(t,"single"),_(t)}function a(){var t=this;r(t,"all"),_(t)}function i(){var t=this;r(t,"store"),_(t)}function r(t,e){var n=$(t).parents(".store_goods");"all"===e?$(t).hasClass("icon-ok-sign")?s(t,n):o(t,n):"single"==e?$(t).hasClass("icon-ok-sign")?c(t,n):l(t,n):$(t).hasClass("icon-ok-sign")?p(t,n):d(t,n),F(t)}function o(t,e){var n=e.find(".single"),a=e.find(".store");n.attr("class","icon-ok-sign single"),a.attr("class","icon-ok-sign store"),$(t).attr("class","icon-ok-sign all")}function s(t,e){var n=e.find(".single"),a=e.find(".store");n.attr("class","icon-circle-blank single font-gray"),a.attr("class","icon-circle-blank store font-gray"),$(t).attr("class","icon-circle-blank all")}function l(t,e){var n=e.find(".all"),a=e.find(".store");$(t).attr("class","icon-ok-sign single");var i=e.find(".icon-circle-blank.single.font-gray").length;i>0?n.attr("class","icon-circle-blank all"):n.attr("class","icon-ok-sign all");var r=e.find(".single").length,o=e.find(".icon-ok-sign.single").length;r==o?a.attr("class","icon-ok-sign store"):a.attr("class","icon-circle-blank store font-gray")}function c(t,e){var n=e.find(".all"),a=e.find(".store");$(t).attr("class","icon-circle-blank single font-gray"),n.attr("class","icon-circle-blank all"),a.attr("class","icon-circle-blank store font-gray")}function d(t,e){var n=e.find(".all"),a=e.find(".single");$(t).attr("class","icon-ok-sign store"),a.attr("class","icon-ok-sign single");var i=e.find(".icon-circle-blank.single.font-gray").length;i>0?n.attr("class","icon-circle-blank all"):n.attr("class","icon-ok-sign all")}function p(t,e){var n=e.find(".all"),a=e.find(".single");$(t).attr("class","icon-circle-blank store font-gray"),n.attr("class","icon-circle-blank all"),a.attr("class","icon-circle-blank single font-gray")}function g(t){var e=t,n=$(e).parents(".container").attr("cart_id");$.ajax({type:"get",url:WapSiteUrl+"/api/index.php?act=buyer_cart&op=del",data:{mid:FL.mid,token:FL.token,cart_id:n,gc_area:1,flag:"wap"},dataType:"json",success:function(t){if(t&&"0"==t.error){var n=$(e).parents(".store_goods");$(e).parents(".container").next(".empty").remove(),$(e).parents(".container").remove();var a=n.find(".container");0==a.length&&n.remove();var i=n.find(".container")[0];_(i),C()}}})}function f(t,e){var n=$(t).parents(".container").find(".goods-price").attr("top_limit"),a=$(t).parents(".container").find(".goods-price").attr("goods_price"),i=$(t).parents(".container").find(".goods-price").attr("killing_price"),r=$(t).parents(".container").find(".goods-price").attr("killing_stock"),o=$(t).parents(".container").find(".goods-price").attr("goods_storage"),s=$(t).parent(),l=$(s).attr("cart_id"),c=parseInt($(t).siblings("input").val());if("add"===e){if(c=++c,c>r&&c>o)return layer.msg("库存不足"),!1;$(t).siblings("input").val(c)}else c<=1?c=1:--c,$(t).siblings("input").val(c);var d=$(t).parents(".container").attr("stock");if(r>d||d&&d<c&&(layer.msg("库存紧张,最多购买"+d+"件哦!"),$(t).siblings("input").val(d),c=d),0!=$(t).parents(".container").find(".goods-limit").length){var p=$(t).parents(".container").find(".goods-limit").attr("limit"),g=$(t).parents(".container").find(".goods-limit").attr("limitPrice"),f=$(t).parents(".container").find(".goods-limit").attr("price");c>=p?$(t).parents(".container").find(".goods-price").text("￥"+g):$(t).parents(".container").find(".goods-price").text("￥"+f)}n&&(c>n&&0!=n?($(t).parents(".container").find(".goods-price").text("￥"+a),$(t).parents(".container").find(".app-seckill").remove(),$(t).parents(".container").find(".sk-limit").remove()):($(t).parents(".container").find(".goods-price").text("￥"+i),0==$(t).parents(".container").find(".app-seckill").length&&$(t).parents(".container").find(".goods-price").after('<img src="../../images/wap/app_miaosha.png" class="app-seckill" /><span class="sk-limit">限购'+n+"件</span>"))),m(t,l,c),_(t)}function m(t,e,n){$.ajax({url:WapSiteUrl+"/api/index.php?act=buyer_cart&op=update",type:"get",data:{token:FL.token,cart_id:e,quantity:n,mid:FL.mid,flag:"wap",gc_area:1},dataType:"json",success:function(t){t&&"0"==t.error}})}function u(){var t=this;f(t,"add")}function h(){var t=this;f(t,"sub")}function v(t){var e=t;($(e.target).val()<=1||isNaN($(e.target).val()))&&$(e.target).val(1);var n=$(e.target).parent(),a=$(n).attr("cart_id"),i=parseInt($(e.target).val()),r=$(e.target).parents(".container").attr("stock"),o=$(e.target).parents(".container").find(".goods-price").attr("top_limit"),s=$(e.target).parents(".container").find(".goods-price").attr("goods_price"),l=$(e.target).parents(".container").find(".goods-price").attr("killing_price"),c=$(e.target).parents(".container").find(".goods-price").attr("killing_stock"),d=$(e.target).parents(".container").find(".goods-price").attr("goods_storage");if(i>c&&i>d)return layer.msg("库存不足"),$(e.target).val(1),!1;if(c>r||r&&r<i&&(layer.msg("库存紧张,最多购买"+r+"件哦!"),$(e.target).val(r),i=r),0!=$(e.target).parents(".container").find(".goods-limit").length){var p=$(e.target).parents(".container").find(".goods-limit").attr("limit"),g=$(e.target).parents(".container").find(".goods-limit").attr("limitPrice"),f=$(e.target).parents(".container").find(".goods-limit").attr("price");i>=p?$(e.target).parents(".container").find(".goods-price").text("￥"+g):$(e.target).parents(".container").find(".goods-price").text("￥"+f)}o&&(i>o&&0!=o?($(e.target).parents(".container").find(".goods-price").text("￥"+s),$(e.target).parents(".container").find(".app-seckill").remove(),$(e.target).parents(".container").find(".sk-limit").remove()):0==$(e.target).parents(".container").find(".app-seckill").length&&($(e.target).parents(".container").find(".goods-price").text("￥"+l),$(e.target).parents(".container").find(".goods-price").after('<img src="../../images/wap/app_miaosha.png" class="app-seckill" /><span class="sk-limit">限购'+o+"件</span>"))),m(e,a,i),_(e.target)}function _(t){for(var e=$(t).parents(".store_goods"),n=e.find(".icon-ok-sign.single"),a=0,i=0,r=parseFloat("0.00"),o=parseFloat("0.00"),s=0,l=parseFloat("0.00"),c=0;c<n.length;c++){var d=$(n[c]).parent(),p=d.find(".goods-price").text().slice(1),g=d.find(".num").val(),f=d.attr("hs_rate");if(0!=d.parents(".container.valid").find(".some-div").length){var m=d.parent().find(".some-div").length*g;a+=m}else a+=parseInt(g);if(1==$($(n)[c]).parent(".container").attr("goods_activity_state")){var u=$($(n)[c]).parent(".container").find(".goods-price").text().slice(1);manselectnum=parseFloat($($(n)[c]).parent(".container").find(".num").val());var h=$(t).parents(".store_goods").find(".manselect");h.attr("manselect_nums1")&&i+manselectnum-h.attr("manselect_nums1")>=0?(s+=parseFloat(u*(h.attr("manselect_nums1")-i)),o=s-h.attr("manselect_money1")):h.attr("manselect_nums0")&&i+manselectnum-h.attr("manselect_nums0")>=0?(s+=parseFloat(u*(h.attr("manselect_nums0")-i)),o=s-h.attr("manselect_money0")):o=0,i+=parseFloat(manselectnum),s+=parseFloat(u*manselectnum)}r+=parseFloat(p*g),l+=parseFloat(p*g*f)}addcookie("cartGoodsNum",a),e.find(".marker").text("共 "+a+" 件"),e.find(".chooseGoods").text("已选"+a+"件商品"),e.find(".total_price").html("￥"+r.toFixed(2)),e.find(".duty").html("￥"+l.toFixed(2)),o>0?e.find(".coupon").html("-￥"+o.toFixed(2)):o=0;var v=e.find(".sec-active .post").attr("free_limit");if(v&&r>=v)e.find(".post .send-full-span").text("已包邮");else if(v&&r<v){var _=v-r;e.find(".post .send-full-span").text("还差"+_.toFixed(2)+"元包邮")}e.find(".amount_price").html("￥"+(r+l-o).toFixed(2)),b(e);for(var k=JSON.parse(sessionStorage.getItem("manselect_info")),y=k[$(e).find(".manselect").attr("store_id")].manselect_rules,x=0,F=0;F<n.length;F++)1==$($(n)[F]).parent().attr("goods_activity_state")&&(g=$($(n)[F]).parent().find(".num").val(),x+=parseFloat(g));for(var w=$(e).find(".manselect .send-full-span"),L=0;L<y.length;L++){if(y[L].manselect_nums-x>0){if(L>0){w.text("已满足【"+y[L-1].manselect_money+"元任选"+y[L-1].manselect_nums+"件】");break}w.text("再购"+(y[L].manselect_nums-x)+"件立享【"+y[L].manselect_money+"元任选"+y[L].manselect_nums+"件】");break}if(y[L].manselect_nums-x==0){w.text("已满足【"+y[L].manselect_money+"元任选"+y[L].manselect_nums+"件】");break}y[L].manselect_nums-x<0&&w.text("已满足【"+y[L].manselect_money+"元任选"+y[L].manselect_nums+"件】")}}function k(){for(var t=$(".store_goods"),e=0;e<t.length;e++){var n=$(t[e]).find(".icon-ok-sign.single");0==n.length&&$(t[e]).find(".tettle").attr("class","tettle btn-unshopping");for(var a=0,i=parseFloat("0.00"),r=parseFloat("0.00"),o=0;o<n.length;o++){var s=$(n[o]).parent(),l=s.find(".goods-price").text().slice(1),c=s.find(".num").val(),d=s.attr("hs_rate");if(0!=s.parents(".container.valid").find(".some-div").length){var p=s.parent().find(".some-div").length*c;a+=p}else a+=parseInt(c);i+=parseFloat(l*c),r+=parseFloat(l*c*d)}addcookie("cartGoodsNum",a),$(t[e]).find(".marker").text("共 "+a+" 件"),$(t[e]).find(".chooseGoods").text("已选"+a+"件商品"),$(t[e]).find(".total_price").html("￥"+i.toFixed(2)),$(t[e]).find(".duty").html("￥"+r.toFixed(2));var g=$(t[e]).find(".sec-active .post").attr("free_limit");if(g&&i>=g)$(t[e]).find(".post .send-full-span").text("已包邮");else if(g&&i<g){var f=g-i;$(t[e]).find(".post .send-full-span").text("还差"+f.toFixed(2)+"元包邮")}$(t[e]).find(".amount_price").html("￥"+(i+r).toFixed(2)),b($(t[e]))}}function b(t){var e=t.find(".icon-ok-sign.single").length,n=(t.find(".duty").text().substr(1),t.find(".amount_price").text().substr(1),t.find(".total_price").text().substr(1)),a=parseFloat(t.find(".store-title").attr("custom_purchase_limit"));if(t.find(".duty").removeClass("line-through"),n>a&&a>0){t.find(".warning").remove();var i="<div class='warning'><p>本包裹超过¥"+a+"了，请分开结算，政策规定本包裹多件商品总价低于¥"+a+"才可过关哦~</p></div>";t.find(".calculatePrice").append(i),t.find(".tettle").attr("class","tettle btn-unshopping")}else 0!=e?(t.find(".tettle").attr("class","tettle btn-shopping"),t.find(".warning").remove()):0==e&&t.find(".warning").remove();$(".tettle").unbind("click"),y()}function y(){$(".btn-shopping").unbind("click").bind("click",function(){var t=this,e=$(this).parents(".store_goods").find(".stockout").length;e>0?layer.msg("所购商品库存不足"):(x(t),location.href="../order/order_confirmation.html?cart_info="+P+"&if_cart=1&area=1&miaosha="+J)})}function x(t){var e,n,a=$(t).parents(".store_goods").find(".container.valid .icon-ok-sign").parent();P="",J="";for(var i=0;i<a.length;i++){var r=$(a[i]).find(".app-seckill");if(0!=r.length){var o=$(a[i]).attr("goods_id");J+=o+","}e=$(a[i]).attr("cart_id"),n=$(a[i]).find(".num").val(),P+=e+"|"+n+","}P=P.substring(0,P.length-1),J=J.substring(0,J.length-1)}function F(t){var e=$(t).parents(".store_goods"),n=e.find(".icon-ok-sign.single").length;0!=n?(e.find(".tettle").attr("class","tettle btn-shopping"),y(),$("#delete").addClass("okdelete")):(e.find(".tettle").attr("class","tettle btn-unshopping"),e.find(".tettle").unbind("click"),$("#delete").removeClass("okdelete"))}function w(){$.ajax({type:"get",url:WapSiteUrl+"/api/index.php?act=buyer_shopping&op=get_goods_scheme",data:{flag:"wap",type:"cainixihuan",num:4,curpage:1,area:1},dataType:"json",success:function(t){if(t&&"0"===t.error){var e=template.render("like_goods",t);$("#likeGoods").html(e);var n=parseInt(.49*$(".container").width());$(".brand-ul img").css({height:n+"px"})}}})}function L(){$(".editAll").unbind("click").bind("click",function(){var t=this;$(t).hasClass("icon-ok-sign")?G(t):S(t)})}function S(){$(".single").attr("class","icon-ok-sign single"),$(".store").attr("class","icon-ok-sign store"),$(".editAll").attr("class","icon-ok-sign editAll")}function G(){$(".single").attr("class","icon-circle-blank single font-gray"),$(".store").attr("class","icon-circle-blank store font-gray"),$(".editAll").attr("class","icon-circle-blank editAll")}function j(t){$.ajax({type:"get",url:WapSiteUrl+"/api/index.php?act=buyer_cart&op=del",data:{mid:FL.mid,token:FL.token,cart_id:t,gc_area:1,flag:"wap"},dataType:"json",success:function(t){if(t&&"0"==t.error){for(var e=$(".icon-ok-sign.single"),n=0;n<e.length;n++){var a=$(e[n]).parents(".store_goods"),i=$(e[n]).parents(".container");i.next(".empty").remove(),i.remove();var r=a.find(".container");0==r.length&&a.remove()}C()}}})}function C(){$(".unvalid .single").attr("class","icon-circle-blank unuseful"),0==$(".store_goods").length&&($("#cart_cn").before(O),G()),0==$(".container").length?$("#edit").hide():$("#edit").show(),$("#start,#delete").hide(),$(".goback").show(),$("#nav-show").show(),$("#likeGoods").show(),$(".calculatePrice").show(),$(".bottom-frame").show(),$("#editBottom").hide(),k(),$("#delete").removeClass("okdelete")}function I(){$(".fh-btn").click(function(){var t=this,e=$(t).parents(".container").attr("cart_id");$.ajax({type:"get",url:WapSiteUrl+"/api/index.php?act=buyer_cart&op=del",data:{mid:FL.mid,token:FL.token,cart_id:e,gc_area:1,flag:"wap"},dataType:"json",success:function(e){if(e&&"0"==e.error){var n=$(t).parents(".store_goods");$(t).parents(".container").next(".empty").remove(),$(t).parents(".container").remove();var a=n.find(".container");0==a.length&&n.remove(),layer.msg("已移除"),0==$(".store_goods").length&&($("#cart_cn").before(O),$("#likeGoods").hide(),$(".bottom-frame").hide())}}})})}function N(){var t=this,e=$(t).attr("store_id"),n=$(t).attr("free_limit"),a=$(t).parents(".store_goods").find(".total_price").text().slice(1);addcookie("storeTotal",a),location.href="shopping_cart_pinkage.html?store_id="+e+"&free_limit="+n+"&type=post"}function T(){var t=this,e=$(t).attr("store_id"),n=$(t).parents(".store_goods").find(".total_price").text().slice(1);addcookie("storeTotal",n),location.href="shopping_cart_pinkage.html?store_id="+e+"&type=send"}function U(){for(var t=$(".container.valid").find(".goods-price"),e=0;e<t.length;e++){var n=$(t[e]).attr("top_limit"),a=($(t[e]).attr("killing_price"),$(t[e]).attr("goods_price")),i=$($(".container.valid")[e]).find(".num").val();n&&i>n&&0!=n&&($(t[e]).text("￥"+a),$($(".container.valid")[e]).find(".app-seckill").remove(),$($(".container.valid")[e]).find(".sk-limit").remove())}}function W(t){$(".fh-dialog").show(),FL.addShade(),$("#leftbtn").click(function(){$(".fh-dialog").hide(),FL.removeShade()}),$("#rightbtn").click(function(){$(".fh-dialog").hide(),t(),FL.removeShade()})}function A(t){t&&0==t.error&&("1"==t.result.is_global?$(".shoppingurl").attr("data-href","../shopping/shopping_cart_global.html"):$(".shoppingurl").attr("data-href","../shopping/shopping_cart_cn.html"))}ImgFormat();var P="",J="",O='<section class="adr-header" style="top:0px !important"><img class="adr-img mt50" src="../../images/wap/Esearch.png" /><div class="adr-tips color9">购物车空空的!</div><div class="btns"><a href="../index/index_global.html" class="button button-block  empty-btn pull-left">随便逛逛</a><a href="../member/history_shop.html?index=0" class="button button-block  empty-btn pull-right">看看关注</a></div></section>';$("#start").click(function(){C()}),$("#edit").click(function(){$("#likeGoods").is(":hidden")||($("#start,#delete").show(),$("#likeGoods").hide(),$("#edit").hide(),$(".goback").hide(),$("#nav-show").hide(),$(".calculatePrice").hide(),$(".bottom-frame").hide(),$("#editBottom").show(),$(".unuseful").attr("class","icon-circle-blank single font-gray"),G(),L())}),$("#delete").click(function(){var t=$(".icon-ok-sign.single");if(0!=t.length){for(var e="",n=0;n<t.length;n++){var a=$(t[n]).parent().attr("cart_id");e+=a+","}e=e.substring(0,e.length-1),W(function(){j(e)})}else layer.msg("您还没有选择商品哦!")}),FL.getGoodsNum({success:A});var q=function(){this.onLoad=function(){e()}};t.Goods=t.Goods||{},Goods.Carts_glo=new q}(this);