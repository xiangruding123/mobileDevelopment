!function(e){function t(e,t,o,a,i){$.ajax({type:"get",url:WapSiteUrl+"/api/index.php?act=common_goods&op=get_goods_list",data:{sid:e,sort:t,order:o,num:a,curpage:i,flag:"wap",is_sale:1},dataType:"json",success:function(e){if(e&&0==e.error){var t=template.render("zGoodsList",e);$("#z_goods_list").append(t),$("#send").click(function(){$(this).hasClass("overhide")?($(this).removeClass("overhide"),$(this).find("i").removeClass("icon-angle-right").addClass("icon-angle-down")):($(this).addClass("overhide"),$(this).find("i").removeClass("icon-angle-down").addClass("icon-angle-right"))})}}})}function o(e,t,o){if("null"!=FL.store_id)var i={token:FL.token,goods_id:e,quantity:1,store_id:FL.store_id,mid:FL.mid,flag:"wap",gc_area:t};else var i={token:FL.token,goods_id:e,quantity:1,mid:FL.mid,flag:"wap",gc_area:t};$.ajax({url:WapSiteUrl+"/api/index.php?act=buyer_cart&op=add",type:"get",dataType:"json",data:i,success:function(e){"0"===e.error?(FL.closeDiv("#mask","hide"),layer.msg("添加购物车成功"),$("#mask").hide(),$(".loading-shade").hide(),a(o)):"0008"===e.error?FL.logLogin():"2001008"===e.error&&(FL.closeDiv("#mask","hide"),$("#mask").hide(),$(".loading-shade").hide())},error:function(e){}})}function a(e){m=parseFloat(m)+parseFloat(e),addcookie("storeTotal",m),$("#z_price").text("￥"+m.toFixed(2)),"post"==u?parseFloat(m)>=parseFloat(g)?$(".z-marker").text("已包邮"):$(".z-marker").text("还差"+parseFloat(g-m).toFixed(2)+"元包邮"):"send"==u&&s(m)}function i(){$("#z_content>.px-index").show(),$("#send").remove(),$("#title").text("提示：以下商品参加满"+parseFloat(g).toFixed(2)+"包邮"),$("#z_price").text("￥"+parseFloat(p).toFixed(2)),parseFloat(p)>=parseFloat(g)?$(".z-marker").text("已包邮"):$(".z-marker").text("还差"+parseFloat(g-p).toFixed(2)+"元包邮"),m=p}function s(e){var t=JSON.parse(unescape(getcookie("manzeng"))),o="";p=e,$(".z-marker").text("");for(var a=0;a<t[c].length;a++)if(t[c][a].gift){var i='<p class="send-p dis-in-b">提示：满'+t[c][a].egt_amount+"减"+(t[c][a].minus_amount||0)+'元，送</p><span class="send-msg focus-font">'+t[c][a].gift.goods_name+'</span><i class="icon-angle-right"></i>';o+=i,t[c][a].minus_amount&&parseFloat(e)>parseFloat(t[c][a].egt_amount)&&$(".z-marker").text("立减"+parseFloat(t[c][a].minus_amount).toFixed(2)+"元")}if(""==$(".z-marker").text()){var s=parseFloat(t[c][0].egt_amount)-parseFloat(e);$(".z-marker").text("差"+parseFloat(s).toFixed(2)+"元立减"+parseFloat(t[c][0].minus_amount).toFixed(2)+"元")}$("#send").html(o),$("#z_price").text("￥"+parseFloat(e).toFixed(2)+"元"),m=e,$("#z_content>.pd-index").hide()}var r=10,n=1,d=0,l=/^[-]{0,1}[0-9]{1,}$/,c=GetQueryString("store_id"),p=getcookie("storeTotal"),g=GetQueryString("free_limit"),m=0,u=GetQueryString("type");ImgFormat(),ImgFormat(),$(window).scroll(function(){var e=document.body.scrollHeight||document.documentElement.scrollHeight,o=document.body.clientHeight||document.documentElement.clientHeight,a=document.body.scrollTop||document.documentElement.scrollTop;if(a+o==e){var i=$(".z-goods").length;page=i/r+1,d!=page&&l.test(page)?(t(c,2,1,r,page),d=page):layer.msg("已经没有商品了")}}),$("#shopping").on("click",".media-cart",function(e){var t=this,a=$(t).attr("goods_id"),i=$(t).attr("goods_source"),s=$(t).attr("goods_price");o(a,i,s),e.preventDefault()});var F=function(){this.onLoad=function(){t(c,2,1,r,n),"post"==u?i():"send"==u&&s(p)}};e.Goods=e.Goods||{},Goods.Pinkage=new F}(this);